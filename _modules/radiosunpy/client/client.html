<!DOCTYPE html>

<html lang="en" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>radiosunpy.client.client &#8212; RadioSunPy v1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="../../../_static/basic.css?v=686e5160" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css?v=27fed22d" />
    <script src="../../../_static/documentation_options.js?v=5cb08e4e"></script>
    <script src="../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for radiosunpy.client.client</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABCMeta</span><span class="p">,</span> <span class="n">abstractmethod</span>
<span class="kn">import</span> <span class="nn">pathlib</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Optional</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">urllib.request</span> <span class="kn">import</span> <span class="n">urlopen</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">astropy.io.ascii</span>
<span class="kn">from</span> <span class="nn">astropy.table</span> <span class="kn">import</span> <span class="n">Column</span><span class="p">,</span> <span class="n">MaskedColumn</span><span class="p">,</span> <span class="n">vstack</span><span class="p">,</span> <span class="n">Table</span><span class="p">,</span> <span class="n">join</span>
<span class="kn">from</span> <span class="nn">astropy.io</span> <span class="kn">import</span> <span class="n">fits</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">interp1d</span>
<span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">trapezoid</span><span class="p">,</span> <span class="n">cumulative_trapezoid</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">minimize</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">curve_fit</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">leastsq</span>
<span class="kn">from</span> <span class="nn">scipy.signal</span> <span class="kn">import</span> <span class="n">fftconvolve</span>
<span class="kn">from</span> <span class="nn">scipy.signal</span> <span class="kn">import</span> <span class="n">find_peaks</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">lru_cache</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">radiosunpy.scrapper</span> <span class="kn">import</span> <span class="n">Scrapper</span>
<span class="kn">from</span> <span class="nn">radiosunpy.time</span> <span class="kn">import</span> <span class="n">TimeRange</span>
<span class="kn">from</span> <span class="nn">radiosunpy.utils</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;RATANClient&#39;</span><span class="p">,</span> <span class="s1">&#39;SRSClient&#39;</span><span class="p">]</span>


<span class="k">class</span> <span class="nc">BaseClient</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="n">ABCMeta</span><span class="p">):</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">acquire_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">form_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>


<div class="viewcode-block" id="SRSClient">
<a class="viewcode-back" href="../../../radiosunpy.client.html#radiosunpy.client.client.SRSClient">[docs]</a>
<span class="k">class</span> <span class="nc">SRSClient</span><span class="p">(</span><span class="n">BaseClient</span><span class="p">):</span>
    <span class="n">base_url</span> <span class="o">=</span> <span class="s1">&#39;ftp://ftp.ngdc.noaa.gov/STP/swpc_products/daily_reports/solar_region_summaries/%Y/%m/%Y%m</span><span class="si">%d</span><span class="s1">SRS.txt&#39;</span>

<div class="viewcode-block" id="SRSClient.extract_lines">
<a class="viewcode-back" href="../../../radiosunpy.client.html#radiosunpy.client.client.SRSClient.extract_lines">[docs]</a>
    <span class="k">def</span> <span class="nf">extract_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">object</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :type content: str with the source data by link</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">section</span><span class="p">,</span> <span class="n">final_section</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">content</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^(I\.|IA\.|II\.)&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
                <span class="n">section</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span>
                    <span class="sa">r</span><span class="s1">&#39;^(III|COMMENT|EFFECTIVE 2 OCT 2000|PLAIN|This message is for users of the NOAA/SEC Space|NNN)&#39;</span><span class="p">,</span>
                    <span class="n">line</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
                <span class="n">final_section</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">final_section</span> <span class="ow">and</span> <span class="n">final_section</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">section</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">section</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">final_section</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">header</span> <span class="o">=</span> <span class="n">content</span><span class="p">[:</span><span class="n">section</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="p">[</span><span class="n">content</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">section</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">section</span><span class="p">:</span>
            <span class="n">content</span><span class="p">[</span><span class="n">line</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;# &#39;</span> <span class="o">+</span> <span class="n">content</span><span class="p">[</span><span class="n">line</span><span class="p">]</span>

        <span class="n">table1</span> <span class="o">=</span> <span class="n">content</span><span class="p">[</span><span class="n">section</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">section</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">table1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Mag\s*Type&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;Magtype&#39;</span><span class="p">,</span> <span class="n">table1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
        <span class="n">table2</span> <span class="o">=</span> <span class="n">content</span><span class="p">[</span><span class="n">section</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span><span class="n">section</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">section</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">table3</span> <span class="o">=</span> <span class="n">content</span><span class="p">[</span><span class="n">section</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span><span class="n">section</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span>
            <span class="n">extra_lines</span> <span class="o">=</span> <span class="n">content</span><span class="p">[</span><span class="n">section</span><span class="p">[</span><span class="mi">3</span><span class="p">]:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">table3</span> <span class="o">=</span> <span class="n">content</span><span class="p">[</span><span class="n">section</span><span class="p">[</span><span class="mi">2</span><span class="p">]:]</span>
            <span class="n">extra_lines</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">table1</span><span class="p">,</span> <span class="n">table2</span><span class="p">,</span> <span class="n">table3</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">table</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">table</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">table</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">title</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">table</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">header</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">extra_lines</span></div>


<div class="viewcode-block" id="SRSClient.proccess_lines">
<a class="viewcode-back" href="../../../radiosunpy.client.html#radiosunpy.client.client.SRSClient.proccess_lines">[docs]</a>
    <span class="k">def</span> <span class="nf">proccess_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">lines</span><span class="p">):</span>
        <span class="n">column_mapping</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Nmbr&#39;</span><span class="p">:</span> <span class="s1">&#39;Number&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Location&#39;</span><span class="p">:</span> <span class="s1">&#39;Location&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Lo&#39;</span><span class="p">:</span> <span class="s1">&#39;Carrington Longitude&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Area&#39;</span><span class="p">:</span> <span class="s1">&#39;Area&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Z&#39;</span><span class="p">:</span> <span class="s1">&#39;Z&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Ll&#39;</span><span class="p">:</span> <span class="s1">&#39;Longitudinal Extent&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Nn&#39;</span><span class="p">:</span> <span class="s1">&#39;Number of Sunspots&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Magtype&#39;</span><span class="p">:</span> <span class="s1">&#39;Mag Type&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Lat&#39;</span><span class="p">:</span> <span class="s1">&#39;Lat&#39;</span>
        <span class="p">}</span>

        <span class="n">column_types</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Number&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;i4&#39;</span><span class="p">),</span>
            <span class="s1">&#39;Location&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;U6&#39;</span><span class="p">),</span>
            <span class="s1">&#39;Carrington Longitude&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;i8&#39;</span><span class="p">),</span>
            <span class="s1">&#39;Area&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;i8&#39;</span><span class="p">),</span>
            <span class="s1">&#39;Z&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;U3&#39;</span><span class="p">),</span>
            <span class="s1">&#39;Longitudinal Extent&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;i8&#39;</span><span class="p">),</span>
            <span class="s1">&#39;Number of Sunspots&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;i8&#39;</span><span class="p">),</span>
            <span class="s1">&#39;Mag Type&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;S4&#39;</span><span class="p">),</span>
            <span class="s1">&#39;Lat&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;i8&#39;</span><span class="p">),</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">lines</span><span class="p">:</span>
            <span class="n">raw_data</span> <span class="o">=</span> <span class="n">astropy</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">ascii</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
            <span class="n">column_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">raw_data</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
            <span class="n">raw_data</span><span class="o">.</span><span class="n">rename_columns</span><span class="p">(</span>
                <span class="n">column_names</span><span class="p">,</span> <span class="n">new_names</span><span class="o">=</span><span class="p">[</span><span class="n">column_mapping</span><span class="p">[</span><span class="n">col</span><span class="o">.</span><span class="n">title</span><span class="p">()]</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">column_names</span><span class="p">]</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">raw_data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">raw_data</span><span class="o">.</span><span class="n">itercols</span><span class="p">():</span>
                    <span class="n">c</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">column_types</span><span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">_name</span><span class="p">]</span>
                <span class="n">raw_data</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="n">Column</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;ID&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;S2&#39;</span><span class="p">)),</span> <span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">raw_data</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="n">Column</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Date&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;S10&#39;</span><span class="p">)),</span> <span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">raw_data</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="n">Column</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">raw_data</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;ID&quot;</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">raw_data</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="n">Column</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">date</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">raw_data</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Date&quot;</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">raw_data</span>
        <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="SRSClient.parse_longitude">
<a class="viewcode-back" href="../../../radiosunpy.client.html#radiosunpy.client.client.SRSClient.parse_longitude">[docs]</a>
    <span class="k">def</span> <span class="nf">parse_longitude</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">longitude_sign</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;W&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">}</span>
        <span class="k">if</span> <span class="s2">&quot;W&quot;</span> <span class="ow">in</span> <span class="n">value</span> <span class="ow">or</span> <span class="s2">&quot;E&quot;</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">longitude_sign</span><span class="p">[</span><span class="n">value</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span> <span class="o">*</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="mi">4</span><span class="p">:])</span></div>


<div class="viewcode-block" id="SRSClient.parse_latitude">
<a class="viewcode-back" href="../../../radiosunpy.client.html#radiosunpy.client.client.SRSClient.parse_latitude">[docs]</a>
    <span class="k">def</span> <span class="nf">parse_latitude</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">latitude_sign</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">}</span>
        <span class="k">if</span> <span class="s2">&quot;N&quot;</span> <span class="ow">in</span> <span class="n">value</span> <span class="ow">or</span> <span class="s2">&quot;S&quot;</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">latitude_sign</span><span class="p">[</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">*</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">])</span></div>


<div class="viewcode-block" id="SRSClient.parse_location">
<a class="viewcode-back" href="../../../radiosunpy.client.html#radiosunpy.client.client.SRSClient.parse_location">[docs]</a>
    <span class="k">def</span> <span class="nf">parse_location</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column</span><span class="p">):</span>
        <span class="n">latitude</span> <span class="o">=</span> <span class="n">MaskedColumn</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Latitude&#39;</span><span class="p">)</span>
        <span class="n">longitude</span> <span class="o">=</span> <span class="n">MaskedColumn</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Longitude&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">loc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">column</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">loc</span><span class="p">:</span>
                <span class="n">lat_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_latitude</span><span class="p">(</span><span class="n">loc</span><span class="p">)</span>
                <span class="n">long_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_longitude</span><span class="p">(</span><span class="n">loc</span><span class="p">)</span>
                <span class="n">latitude</span> <span class="o">=</span> <span class="n">latitude</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">lat_value</span><span class="p">)</span>
                <span class="n">longitude</span> <span class="o">=</span> <span class="n">longitude</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">long_val</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">latitude</span> <span class="o">=</span> <span class="n">latitude</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">longitude</span> <span class="o">=</span> <span class="n">longitude</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span></div>


<div class="viewcode-block" id="SRSClient.parse_lat_col">
<a class="viewcode-back" href="../../../radiosunpy.client.html#radiosunpy.client.client.SRSClient.parse_lat_col">[docs]</a>
    <span class="k">def</span> <span class="nf">parse_lat_col</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">latitude_column</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">loc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">column</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">loc</span><span class="p">:</span>
                <span class="n">latitude_column</span><span class="o">.</span><span class="n">mask</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">latitude_column</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_latitude</span><span class="p">(</span><span class="n">loc</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">latitude_column</span></div>


<div class="viewcode-block" id="SRSClient.acquire_data">
<a class="viewcode-back" href="../../../radiosunpy.client.html#radiosunpy.client.client.SRSClient.acquire_data">[docs]</a>
    <span class="k">def</span> <span class="nf">acquire_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timerange</span><span class="p">:</span> <span class="n">TimeRange</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function for collecting data with predefined timerange</span>

<span class="sd">        :param timerange: TimeRange object with time span for ARs searching</span>
<span class="sd">        :type timerange: TimeRange</span>
<span class="sd">        :returns: list of urls with txt files.</span>
<span class="sd">        :rtype: list of string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">scrapper</span> <span class="o">=</span> <span class="n">Scrapper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">scrapper</span><span class="o">.</span><span class="n">form_fileslist</span><span class="p">(</span><span class="n">timerange</span><span class="p">)</span></div>


<div class="viewcode-block" id="SRSClient.form_data">
<a class="viewcode-back" href="../../../radiosunpy.client.html#radiosunpy.client.client.SRSClient.form_data">[docs]</a>
    <span class="k">def</span> <span class="nf">form_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_urls</span><span class="p">):</span>
        <span class="n">total_table</span><span class="p">,</span> <span class="n">section_lines</span><span class="p">,</span> <span class="n">final_section_lines</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">file_url</span> <span class="ow">in</span> <span class="n">file_urls</span><span class="p">:</span>
            <span class="n">tables</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">with</span> <span class="n">urlopen</span><span class="p">(</span><span class="n">file_url</span><span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">header</span><span class="p">,</span> <span class="n">section_lines</span><span class="p">,</span> <span class="n">supplementary_lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_lines</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
                <span class="n">issued_lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">header</span> <span class="k">if</span> <span class="s1">&#39;issued&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">and</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">date_text</span> <span class="o">=</span> <span class="n">issued_lines</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
                <span class="n">issued_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">date_text</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="s2">&quot;%Y %b </span><span class="si">%d</span><span class="s2"> %H%M UTC&quot;</span><span class="p">)</span>
                <span class="n">meta_id</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">header</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">h</span><span class="o">.</span><span class="n">startswith</span><span class="p">((</span><span class="s2">&quot;I.&quot;</span><span class="p">,</span> <span class="s2">&quot;IA.&quot;</span><span class="p">,</span> <span class="s2">&quot;II.&quot;</span><span class="p">)):</span>
                        <span class="n">pos</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
                        <span class="nb">id</span> <span class="o">=</span> <span class="n">h</span><span class="p">[:</span><span class="n">pos</span><span class="p">]</span>
                        <span class="n">id_text</span> <span class="o">=</span> <span class="n">h</span><span class="p">[</span><span class="n">pos</span> <span class="o">+</span> <span class="mi">2</span><span class="p">:]</span>
                        <span class="n">meta_id</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">id_text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">lines</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">meta_id</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">section_lines</span><span class="p">):</span>
                    <span class="n">raw_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proccess_lines</span><span class="p">(</span><span class="n">issued_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">),</span> <span class="n">key</span><span class="p">,</span> <span class="n">lines</span><span class="p">)</span>
                    <span class="n">tables</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">raw_data</span><span class="p">)</span>
                <span class="n">stacked_table</span> <span class="o">=</span> <span class="n">vstack</span><span class="p">(</span><span class="n">tables</span><span class="p">)</span>

                <span class="k">if</span> <span class="s1">&#39;Location&#39;</span> <span class="ow">in</span> <span class="n">stacked_table</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                    <span class="n">col_lat</span><span class="p">,</span> <span class="n">col_lon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_location</span><span class="p">(</span><span class="n">stacked_table</span><span class="p">[</span><span class="s1">&#39;Location&#39;</span><span class="p">])</span>
                    <span class="k">del</span> <span class="n">stacked_table</span><span class="p">[</span><span class="s1">&#39;Location&#39;</span><span class="p">]</span>
                    <span class="n">stacked_table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="n">col_lat</span><span class="p">)</span>
                    <span class="n">stacked_table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="n">col_lon</span><span class="p">)</span>

                <span class="k">if</span> <span class="s1">&#39;Lat&#39;</span> <span class="ow">in</span> <span class="n">stacked_table</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parse_lat_col</span><span class="p">(</span><span class="n">stacked_table</span><span class="p">[</span><span class="s1">&#39;Lat&#39;</span><span class="p">],</span> <span class="n">stacked_table</span><span class="p">[</span><span class="s1">&#39;Latitude&#39;</span><span class="p">])</span>
                    <span class="k">del</span> <span class="n">stacked_table</span><span class="p">[</span><span class="s1">&#39;Lat&#39;</span><span class="p">]</span>

            <span class="n">total_table</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stacked_table</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Table</span><span class="p">(</span><span class="n">vstack</span><span class="p">(</span><span class="n">total_table</span><span class="p">))</span></div>


<div class="viewcode-block" id="SRSClient.get_data">
<a class="viewcode-back" href="../../../radiosunpy.client.html#radiosunpy.client.client.SRSClient.get_data">[docs]</a>
    <span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timerange</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function for collecting data with predefined timerange</span>
<span class="sd">        :param timerange:</span>
<span class="sd">        :type timerange: TimeRange</span>
<span class="sd">        :return: data table</span>
<span class="sd">        :rtype: Table</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">file_urls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">acquire_data</span><span class="p">(</span><span class="n">timerange</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">form_data</span><span class="p">(</span><span class="n">file_urls</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="RATANClient">
<a class="viewcode-back" href="../../../radiosunpy.client.html#radiosunpy.client.client.RATANClient">[docs]</a>
<span class="k">class</span> <span class="nc">RATANClient</span><span class="p">(</span><span class="n">BaseClient</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Client for processing and analyzing data from the RATAN-600 radio telescope.</span>

<span class="sd">    RATANClient class is a complex implementation that extends a base client class for handling and processing data</span>
<span class="sd">    related to solar observations using RATAN-600. The class provides a wide range of methods to acquire, process,</span>
<span class="sd">    and analyze solar data from FITS (Flexible Image Transport System) files obtained from a given URL. Hereâ€™s an</span>
<span class="sd">    overview of what each method does:</span>

<span class="sd">    Key Components:</span>
<span class="sd">    1. Initialization Parameters and Configuration:</span>

<span class="sd">        - `base_url`: URL template to fetch solar data.</span>
<span class="sd">        - regex_pattern: A regex pattern to match relevant data files.</span>
<span class="sd">        - convolution_template and quiet_sun_model: Loaded from Excel files; these are templates or models of solar data</span>
<span class="sd">        that will be used in the analysis.</span>

<span class="sd">    2.Data Acquisition and Filtering:</span>
<span class="sd">        - `acquire_data`: Uses a Scrapper class to form a list of data files for a given</span>
<span class="sd">        time range, based on URL and regex pattern.</span>
<span class="sd">        - `get_scans`: Fetches data from acquired file URLs, processes the FITS</span>
<span class="sd">        files to extract relevant information, and returns a table with structured data.</span>

<span class="sd">    3. Data Processing and Analysis:</span>

<span class="sd">        3.1 Convolution and Efficiency Calculations:</span>

<span class="sd">            - convolve_sun: Simulates the convolution of a solar model with Gaussian and rectangular functions, then</span>
<span class="sd">              computes and returns the ratio of areas under these convolved functions.</span>
<span class="sd">            - antenna_efficiency: Calculates the antenna efficiency across various frequencies using the convolution data.</span>

<span class="sd">        3.2 Calibration:</span>

<span class="sd">            - calibrate_QSModel: Calibrates the quiet sun model data against observed scan data, adjusting for flux efficiency</span>
<span class="sd">              and other parameters</span>

<span class="sd">        3.3 Positional and Rotational Transformations:</span>
<span class="sd">            - heliocentric_transform: Converts solar latitude and longitude into heliocentric coordinates.</span>
<span class="sd">            - pozitional_rotation: Rotates positional data based on a given angle.</span>
<span class="sd">            - differential_rotation: Calculates the differential rotation rate of the sun based on latitude.</span>
<span class="sd">            - pozitional_angle: Computes the positional angle of the sun based on azimuth, solar declination, and solar P-angle.</span>

<span class="sd">        3.4 Active Regions and Peak Analysis:</span>
<span class="sd">            - active_regions_search: Identifies active regions on the sun by comparing observed data to known solar</span>
<span class="sd">              active region locations using wavelet denoising and peak detection.</span>
<span class="sd">            - make_multigauss_fit: Fits multiple Gaussian functions to data points, extracting amplitude, mean, and</span>
<span class="sd">              standard deviation for each detected peak.</span>
<span class="sd">            - gauss_analysis: Performs Gaussian analysis on identified active regions and associates various metrics</span>
<span class="sd">              (amplitude, mean, flux, etc.) with these regions.</span>




<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    base_url : str</span>
<span class="sd">        Base URL template for accessing data files.</span>
<span class="sd">    regex_pattern : str</span>
<span class="sd">        Regular expression pattern to match file names.</span>
<span class="sd">    convolution_template : pd.DataFrame</span>
<span class="sd">        Template for convolving the quiet Sun model, loaded from the Excel file.</span>
<span class="sd">    quiet_sun_model : pd.DataFrame</span>
<span class="sd">        Model for the quiet Sun brightness temperature, loaded from the Excel file.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">base_url</span> <span class="o">=</span> <span class="s1">&#39;http://spbf.sao.ru/data/ratan/%Y/%m/%Y%m</span><span class="si">%d</span><span class="s1">_%H%M%S_sun+0_out.fits&#39;</span>
    <span class="n">regex_pattern</span> <span class="o">=</span> <span class="s1">&#39;((\d{6,8})[^0-9].*[^0-9]0_out.fits)&#39;</span>

    <span class="n">convolution_template</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">absolute</span><span class="p">()</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s1">&#39;quiet_sun_template.xlsx&#39;</span><span class="p">))</span>
    <span class="n">quiet_sun_model</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">absolute</span><span class="p">()</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s1">&#39;quiet_sun_model.xlsx&#39;</span><span class="p">))</span>

<div class="viewcode-block" id="RATANClient.process_fits_data">
<a class="viewcode-back" href="../../../radiosunpy.client.html#radiosunpy.client.client.RATANClient.process_fits_data">[docs]</a>
    <span class="k">def</span> <span class="nf">process_fits_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                          <span class="n">path_to_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                          <span class="n">bad_freq</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                          <span class="n">save_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                          <span class="n">save_with_original</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                          <span class="n">save_raw</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
                          <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">fits</span><span class="o">.</span><span class="n">HDUList</span><span class="p">,</span> <span class="n">fits</span><span class="o">.</span><span class="n">HDUList</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Process FITS data from a given URL or file_path from the disk, optionally saving the original and processed data to a file,</span>
<span class="sd">        and return the processed data as a FITS HDUList object.</span>

<span class="sd">        :param path_to_file: The URL of the FITS file to process or path to file at disk.</span>
<span class="sd">        :type path_to_file: str</span>
<span class="sd">        :param bad_freq: A list of bad frequencies to exclude from the data acquisition.</span>
<span class="sd">        :type bad_freq: list of float</span>
<span class="sd">        :param save_path: Path to save the processed FITS data. If None, the processed FITS object is returned.</span>
<span class="sd">        :type save_path: Optional[str]</span>
<span class="sd">        :param save_with_original: Whether to save the original data or not.</span>
<span class="sd">        :type save_with_original: bool</span>
<span class="sd">        :param save_raw: Whether to save raw FITS data or not.</span>
<span class="sd">         :type save_raw: bool</span>
<span class="sd">        :returns: The raw and processed FITS data object.</span>
<span class="sd">        :rtype: Tuple[fits.HDUList, fits.HDUList]</span>

<span class="sd">        :Example:</span>

<span class="sd">        .. code-block:: python</span>


<span class="sd">            &gt;&gt;&gt; ratan_client = RATANClient()</span>
<span class="sd">            &gt;&gt;&gt; raw, processed = ratan_client.process_fits_data(&#39;http://spbf.sao.ru/data/ratan/2017/09/20170903_121257_sun+0_out.fits&#39;)</span>
<span class="sd">            &gt;&gt;&gt; isinstance(processed, fits.HDUList)</span>
<span class="sd">            True</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">bad_freq</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">bad_freq</span> <span class="o">=</span> <span class="p">[</span><span class="mf">15.0938</span><span class="p">,</span> <span class="mf">15.2812</span><span class="p">,</span> <span class="mf">15.4688</span><span class="p">,</span> <span class="mf">15.6562</span><span class="p">,</span> <span class="mf">15.8438</span><span class="p">,</span> <span class="mf">16.0312</span><span class="p">,</span> <span class="mf">16.2188</span><span class="p">,</span> <span class="mf">16.4062</span><span class="p">]</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">path_to_file</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">file_name_processed</span> <span class="o">=</span> <span class="n">file_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.fits&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_processed.fits&#39;</span>
        <span class="n">hdul</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">path_to_file</span><span class="p">)</span>
        <span class="n">hdul</span><span class="o">.</span><span class="n">verify</span><span class="p">(</span><span class="s1">&#39;fix&#39;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>

        <span class="n">CDELT1</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;CDELT1&#39;</span><span class="p">]</span>
        <span class="n">CRPIX</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;CRPIX1&#39;</span><span class="p">]</span>
        <span class="n">SOLAR_R</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;SOLAR_R&#39;</span><span class="p">]</span>
        <span class="n">SOLAR_B</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;SOLAR_B&#39;</span><span class="p">]</span>
        <span class="n">FREQ</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;FREQ&#39;</span><span class="p">]</span>
        <span class="n">OBS_DATE</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;DATE-OBS&#39;</span><span class="p">]</span>
        <span class="n">OBS_TIME</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;TIME-OBS&#39;</span><span class="p">]</span>
        <span class="n">bad_freq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">FREQ</span><span class="p">,</span> <span class="n">bad_freq</span><span class="p">)</span>

        <span class="n">AZIMUTH</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;AZIMUTH&#39;</span><span class="p">]</span>
        <span class="n">SOL_DEC</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;SOL_DEC&#39;</span><span class="p">]</span>
        <span class="n">SOLAR_P</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;SOLAR_P&#39;</span><span class="p">]</span>

        <span class="n">angle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pozitional_angle</span><span class="p">(</span><span class="n">AZIMUTH</span><span class="p">,</span> <span class="n">SOL_DEC</span><span class="p">,</span> <span class="n">SOLAR_P</span><span class="p">)</span>
        <span class="n">N_shape</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
            <span class="o">-</span> <span class="n">CRPIX</span> <span class="o">*</span> <span class="n">CDELT1</span><span class="p">,</span>
            <span class="p">(</span><span class="n">N_shape</span> <span class="o">-</span> <span class="n">CRPIX</span><span class="p">)</span> <span class="o">*</span> <span class="n">CDELT1</span><span class="p">,</span>
            <span class="n">num</span><span class="o">=</span><span class="n">N_shape</span>
        <span class="p">)</span>
        <span class="n">flux_eficiency</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">antenna_efficiency</span><span class="p">(</span><span class="n">FREQ</span><span class="p">,</span> <span class="n">SOLAR_R</span><span class="p">)</span>
        <span class="n">mask</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">V</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calibrate_QSModel</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">SOLAR_R</span><span class="p">,</span> <span class="n">FREQ</span><span class="p">,</span> <span class="n">flux_eficiency</span><span class="p">)</span>
        <span class="n">I</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">FREQ</span> <span class="o">=</span> <span class="n">I</span><span class="p">[</span><span class="o">~</span><span class="n">bad_freq</span><span class="p">],</span> <span class="n">V</span><span class="p">[</span><span class="o">~</span><span class="n">bad_freq</span><span class="p">],</span> <span class="n">FREQ</span><span class="p">[</span><span class="o">~</span><span class="n">bad_freq</span><span class="p">]</span>

        <span class="c1"># Pack the processed data into FITS format</span>
        <span class="k">if</span> <span class="n">save_with_original</span><span class="p">:</span>
            <span class="n">primary_hdu</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">PrimaryHDU</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">primary_hdu</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">PrimaryHDU</span><span class="p">()</span>
        <span class="n">I_hdu</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">ImageHDU</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">I</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;I&#39;</span><span class="p">)</span>
        <span class="n">V_hdu</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">ImageHDU</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">V</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;V&#39;</span><span class="p">)</span>
        <span class="n">freq_hdu</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">ImageHDU</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">FREQ</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;FREQ&#39;</span><span class="p">)</span>
        <span class="n">mask_hdu</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">ImageHDU</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mask</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int8&#39;</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;mask&#39;</span><span class="p">)</span>

        <span class="n">header</span> <span class="o">=</span> <span class="n">primary_hdu</span><span class="o">.</span><span class="n">header</span>
        <span class="n">header</span><span class="p">[</span><span class="s1">&#39;CDELT1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CDELT1</span>
        <span class="n">header</span><span class="p">[</span><span class="s1">&#39;CRPIX1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CRPIX</span>
        <span class="n">header</span><span class="p">[</span><span class="s1">&#39;SOLAR_R&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SOLAR_R</span>
        <span class="n">header</span><span class="p">[</span><span class="s1">&#39;SOLAR_B&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SOLAR_B</span>
        <span class="n">header</span><span class="p">[</span><span class="s1">&#39;DATE-OBS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">OBS_DATE</span>
        <span class="n">header</span><span class="p">[</span><span class="s1">&#39;TIME-OBS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">OBS_TIME</span>
        <span class="n">header</span><span class="p">[</span><span class="s1">&#39;AZIMUTH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">AZIMUTH</span>
        <span class="n">header</span><span class="p">[</span><span class="s1">&#39;SOL_DEC&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SOL_DEC</span>
        <span class="n">header</span><span class="p">[</span><span class="s1">&#39;SOLAR_P&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SOLAR_P</span>
        <span class="n">header</span><span class="p">[</span><span class="s1">&#39;ANGLE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">angle</span>

        <span class="n">hdulist</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">HDUList</span><span class="p">([</span><span class="n">primary_hdu</span><span class="p">,</span> <span class="n">I_hdu</span><span class="p">,</span> <span class="n">V_hdu</span><span class="p">,</span> <span class="n">freq_hdu</span><span class="p">,</span> <span class="n">mask_hdu</span><span class="p">,</span> <span class="n">hdul</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
        <span class="n">hdulist</span><span class="o">.</span><span class="n">verify</span><span class="p">(</span><span class="s1">&#39;fix&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">save_path</span><span class="p">:</span>
            <span class="n">hdulist</span><span class="o">.</span><span class="n">writeto</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">save_path</span><span class="p">)</span> <span class="o">/</span> <span class="n">file_name_processed</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">save_raw</span><span class="p">:</span>
            <span class="n">hdul</span><span class="o">.</span><span class="n">writeto</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">save_path</span><span class="p">)</span> <span class="o">/</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">hdul</span><span class="p">,</span> <span class="n">hdulist</span></div>


<div class="viewcode-block" id="RATANClient.process_fits_with_period">
<a class="viewcode-back" href="../../../radiosunpy.client.html#radiosunpy.client.client.RATANClient.process_fits_with_period">[docs]</a>
    <span class="k">def</span> <span class="nf">process_fits_with_period</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timerange</span><span class="p">:</span> <span class="n">TimeRange</span><span class="p">,</span>
                                 <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">fits</span><span class="o">.</span><span class="n">HDUList</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">fits</span><span class="o">.</span><span class="n">HDUList</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Process fits files with a period by urls taken from http://spbf.sao.ru/ and return list of raw</span>
<span class="sd">        fits files and processed fits, all kwargs from process_fits_data are available,</span>
<span class="sd">         such as option for saving processed fits and raw fits to directory.</span>

<span class="sd">        :param timerange: Period of time for which scans will be downloaded and processed</span>
<span class="sd">        :param kwargs: keyword arguments valid for process _fits_data</span>
<span class="sd">        :return: Tuple[List[fits.HDUList], List[fits.HDUList]]</span>

<span class="sd">         :Example:</span>

<span class="sd">        .. code-block:: python</span>
<span class="sd">        &gt;&gt;&gt; time_range = TimeRange(&quot;2017-09-03&quot;, &quot;2017-09-04&quot;)</span>
<span class="sd">        &gt;&gt;&gt; ratan_client = RATANClient()</span>
<span class="sd">        &gt;&gt;&gt; _, list_phdul = ratan_client.process_fits_with_period(time_range)</span>
<span class="sd">        &gt;&gt;&gt; isinstance(list_phdul, list)</span>
<span class="sd">        True</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">acquire_data</span><span class="p">(</span><span class="n">timerange</span><span class="p">)</span>
        <span class="n">raw_hdul</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">processed_hdul</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">url_list</span><span class="p">:</span>
            <span class="n">hdul</span><span class="p">,</span> <span class="n">hdulist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_fits_data</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">raw_hdul</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hdul</span><span class="p">)</span>
            <span class="n">processed_hdul</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hdulist</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">raw_hdul</span><span class="p">,</span> <span class="n">processed_hdul</span></div>


<div class="viewcode-block" id="RATANClient.get_local_sources_info_from_processed">
<a class="viewcode-back" href="../../../radiosunpy.client.html#radiosunpy.client.client.RATANClient.get_local_sources_info_from_processed">[docs]</a>
    <span class="k">def</span> <span class="nf">get_local_sources_info_from_processed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                              <span class="n">pr_data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">fits</span><span class="o">.</span><span class="n">hdu</span><span class="o">.</span><span class="n">hdulist</span><span class="o">.</span><span class="n">HDUList</span><span class="p">],</span>
                                              <span class="n">bad_freq</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Table</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute local sources info from a processed FITS HDUList and NOAA active regions coordnate info</span>
<span class="sd">        :param pr_data:  string with path to file or direct url to source fits or fits file</span>
<span class="sd">        :type pr_data: str or fits.hdu.hdulist.HDUList</span>
<span class="sd">        :param bad_freq:  list of bd frequencies excluded from computation</span>
<span class="sd">        :type bad_freq: list of float</span>
<span class="sd">        :return: astropy table with local sources info</span>
<span class="sd">        :rtype: Table</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pr_data</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">processed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_fits_data</span><span class="p">(</span><span class="n">pr_data</span><span class="p">,</span>
                                                  <span class="n">save_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                                  <span class="n">save_with_original</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pr_data</span><span class="p">,</span> <span class="n">fits</span><span class="o">.</span><span class="n">hdu</span><span class="o">.</span><span class="n">hdulist</span><span class="o">.</span><span class="n">HDUList</span><span class="p">):</span>
            <span class="n">processed</span> <span class="o">=</span> <span class="n">pr_data</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="ne">NotImplementedError</span>

        <span class="k">if</span> <span class="n">bad_freq</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">bad_freq</span> <span class="o">=</span> <span class="p">[</span><span class="mf">15.0938</span><span class="p">,</span> <span class="mf">15.2812</span><span class="p">,</span> <span class="mf">15.4688</span><span class="p">,</span> <span class="mf">15.6562</span><span class="p">,</span> <span class="mf">15.8438</span><span class="p">,</span> <span class="mf">16.0312</span><span class="p">,</span> <span class="mf">16.2188</span><span class="p">,</span> <span class="mf">16.4062</span><span class="p">]</span>

        <span class="n">srs_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">form_srstable_with_time_shift</span><span class="p">(</span><span class="n">processed</span><span class="p">)</span>

        <span class="n">CDELT1</span> <span class="o">=</span> <span class="n">processed</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;CDELT1&#39;</span><span class="p">]</span>
        <span class="n">CRPIX</span> <span class="o">=</span> <span class="n">processed</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;CRPIX1&#39;</span><span class="p">]</span>
        <span class="n">AZIMUTH</span> <span class="o">=</span> <span class="n">processed</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;AZIMUTH&#39;</span><span class="p">]</span>
        <span class="n">FREQ</span> <span class="o">=</span> <span class="n">processed</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
        <span class="n">bad_freq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">FREQ</span><span class="p">,</span> <span class="n">bad_freq</span><span class="p">)</span>
        <span class="n">I</span> <span class="o">=</span> <span class="n">processed</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
        <span class="n">V</span> <span class="o">=</span> <span class="n">processed</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">processed</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
        <span class="n">I</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">FREQ</span> <span class="o">=</span> <span class="n">I</span><span class="p">[</span><span class="o">~</span><span class="n">bad_freq</span><span class="p">],</span> <span class="n">V</span><span class="p">[</span><span class="o">~</span><span class="n">bad_freq</span><span class="p">],</span> <span class="n">FREQ</span><span class="p">[</span><span class="o">~</span><span class="n">bad_freq</span><span class="p">]</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
            <span class="o">-</span> <span class="n">CRPIX</span> <span class="o">*</span> <span class="n">CDELT1</span><span class="p">,</span>
            <span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">CRPIX</span><span class="p">)</span> <span class="o">*</span> <span class="n">CDELT1</span><span class="p">,</span>
            <span class="n">num</span><span class="o">=</span><span class="n">V</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="n">source_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_regions_search</span><span class="p">(</span><span class="n">srs_table</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span>

        <span class="n">ar_amount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">source_info</span><span class="p">)</span>
        <span class="n">source_info</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Azimuth&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">AZIMUTH</span><span class="p">]</span> <span class="o">*</span> <span class="n">ar_amount</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;i2&#39;</span><span class="p">)),</span> <span class="n">index</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">source_info</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span>
            <span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Amplitude&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">[[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">FREQ</span><span class="p">))]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ar_amount</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">))</span>
        <span class="n">source_info</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span>
            <span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Mean&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">[[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">FREQ</span><span class="p">))]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ar_amount</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">))</span>
        <span class="n">source_info</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span>
            <span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Sigma&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">[[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">FREQ</span><span class="p">))]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ar_amount</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">))</span>
        <span class="n">source_info</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span>
            <span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;FWHM&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">[[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">FREQ</span><span class="p">))]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ar_amount</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">))</span>
        <span class="n">source_info</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span>
            <span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Flux&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">[[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">FREQ</span><span class="p">))]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ar_amount</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">))</span>
        <span class="n">source_info</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span>
            <span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Total Flux&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">[[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">FREQ</span><span class="p">))]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ar_amount</span><span class="p">)],</span>
                   <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">))</span>
        <span class="n">source_info</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span>
            <span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Range&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">[[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">FREQ</span><span class="p">))]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ar_amount</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">))</span>

        <span class="n">ratan_data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">FREQ</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">V</span><span class="p">))</span>
        <span class="n">source_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gauss_analysis</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ratan_data</span><span class="p">,</span> <span class="n">source_info</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">source_info</span></div>


<div class="viewcode-block" id="RATANClient.get_ar_info_from_processed">
<a class="viewcode-back" href="../../../radiosunpy.client.html#radiosunpy.client.client.RATANClient.get_ar_info_from_processed">[docs]</a>
    <span class="k">def</span> <span class="nf">get_ar_info_from_processed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pr_data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">fits</span><span class="o">.</span><span class="n">hdu</span><span class="o">.</span><span class="n">hdulist</span><span class="o">.</span><span class="n">HDUList</span><span class="p">],</span>
                                   <span class="n">bad_freq</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">fits</span><span class="o">.</span><span class="n">HDUList</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute ar parameters (total flux, maximum amplitude, width (in arcsec))  info from</span>
<span class="sd">        a processed FITS HDUList and NOAA active regions coordnate info</span>
<span class="sd">        :param pr_data:  string with path to file or direct url to source fits or fits file</span>
<span class="sd">        :type pr_data: str or fits.hdu.hdulist.HDUList</span>
<span class="sd">        :param bad_freq:  list of bd frequencies excluded from computation</span>
<span class="sd">        :type bad_freq: list of float</span>
<span class="sd">        :return: astropy table with local sources info</span>
<span class="sd">        :rtype: Table</span>

<span class="sd">        &gt;&gt;&gt; raw_fits_data_path = get_project_root() / &#39;data&#39; / &#39;20170903_121257_sun+0_out.fits&#39;</span>
<span class="sd">        &gt;&gt;&gt; ratan_client = RATANClient()</span>
<span class="sd">        &gt;&gt;&gt; hdul = ratan_client.get_ar_info_from_processed(str(raw_fits_data_path))</span>
<span class="sd">        &gt;&gt;&gt; assert hdul[1].data[0][&#39;Number&#39;] == 2673</span>
<span class="sd">        &gt;&gt;&gt; assert hdul[1].data[0][&#39;TotalFlux&#39;].shape == (84,)</span>
<span class="sd">        &gt;&gt;&gt; assert hdul[1].data[0][&#39;MaxAmplitude&#39;].shape == (84,)</span>
<span class="sd">        &gt;&gt;&gt; assert hdul[1].data[0][&#39;MaxLat&#39;].shape == (84,)</span>
<span class="sd">        &gt;&gt;&gt; assert hdul[1].data[0][&#39;MinLat&#39;].shape == (84,)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pr_data</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">PosixPath</span><span class="p">,</span> <span class="n">fits</span><span class="o">.</span><span class="n">hdu</span><span class="o">.</span><span class="n">hdulist</span><span class="o">.</span><span class="n">HDUList</span><span class="p">)),</span> \
            <span class="s1">&#39;Processed data should be link to file, path to fits data of fits data&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pr_data</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">PosixPath</span><span class="p">)):</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">processed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_fits_data</span><span class="p">(</span><span class="n">pr_data</span><span class="p">,</span>
                                                  <span class="n">save_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                                  <span class="n">save_with_original</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">processed</span> <span class="o">=</span> <span class="n">pr_data</span>

        <span class="k">if</span> <span class="n">bad_freq</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">bad_freq</span> <span class="o">=</span> <span class="p">[</span><span class="mf">15.0938</span><span class="p">,</span> <span class="mf">15.2812</span><span class="p">,</span> <span class="mf">15.4688</span><span class="p">,</span> <span class="mf">15.6562</span><span class="p">,</span> <span class="mf">15.8438</span><span class="p">,</span> <span class="mf">16.0312</span><span class="p">,</span> <span class="mf">16.2188</span><span class="p">,</span> <span class="mf">16.4062</span><span class="p">]</span>

        <span class="n">srs_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">form_srstable_with_time_shift</span><span class="p">(</span><span class="n">processed</span><span class="p">)</span>

        <span class="n">CDELT1</span> <span class="o">=</span> <span class="n">processed</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;CDELT1&#39;</span><span class="p">]</span>
        <span class="n">CRPIX</span> <span class="o">=</span> <span class="n">processed</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;CRPIX1&#39;</span><span class="p">]</span>
        <span class="n">AZIMUTH</span> <span class="o">=</span> <span class="n">processed</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;AZIMUTH&#39;</span><span class="p">]</span>
        <span class="n">FREQ</span> <span class="o">=</span> <span class="n">processed</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
        <span class="n">bad_freq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">FREQ</span><span class="p">,</span> <span class="n">bad_freq</span><span class="p">)</span>
        <span class="n">I</span> <span class="o">=</span> <span class="n">processed</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
        <span class="n">V</span> <span class="o">=</span> <span class="n">processed</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">processed</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
        <span class="n">I</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">FREQ</span> <span class="o">=</span> <span class="n">I</span><span class="p">[</span><span class="o">~</span><span class="n">bad_freq</span><span class="p">],</span> <span class="n">V</span><span class="p">[</span><span class="o">~</span><span class="n">bad_freq</span><span class="p">],</span> <span class="n">FREQ</span><span class="p">[</span><span class="o">~</span><span class="n">bad_freq</span><span class="p">]</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
            <span class="o">-</span> <span class="n">CRPIX</span> <span class="o">*</span> <span class="n">CDELT1</span><span class="p">,</span>
            <span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">CRPIX</span><span class="p">)</span> <span class="o">*</span> <span class="n">CDELT1</span><span class="p">,</span>
            <span class="n">num</span><span class="o">=</span><span class="n">V</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">primary_hdu</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">PrimaryHDU</span><span class="p">(</span><span class="n">FREQ</span><span class="p">)</span>
        <span class="n">primary_hdu</span><span class="o">.</span><span class="n">header</span> <span class="o">=</span> <span class="n">processed</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span>
        <span class="n">source_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_regions_search</span><span class="p">(</span><span class="n">srs_table</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span>

        <span class="n">ar_numbers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">source_info</span><span class="p">[</span><span class="s1">&#39;Number&#39;</span><span class="p">])</span>
        <span class="n">total_flux_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">max_amplitude_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">max_x_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">min_x_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">noaa_ar</span> <span class="ow">in</span> <span class="n">ar_numbers</span><span class="p">:</span>
            <span class="n">region_info</span> <span class="o">=</span> <span class="n">source_info</span><span class="p">[</span><span class="n">source_info</span><span class="p">[</span><span class="s1">&#39;Number&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">noaa_ar</span><span class="p">]</span>
            <span class="n">scan_data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">FREQ</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">V</span><span class="p">))</span>
            <span class="n">total_flux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">FREQ</span><span class="p">)</span>
            <span class="n">max_amplitude</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">FREQ</span><span class="p">)</span>
            <span class="n">max_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">FREQ</span><span class="p">)</span>
            <span class="n">min_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">FREQ</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">elem</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">scan_data</span><span class="p">):</span>
                <span class="n">freq</span><span class="p">,</span> <span class="n">I_data</span><span class="p">,</span> <span class="n">V_data</span> <span class="o">=</span> <span class="n">elem</span>
                <span class="n">gauss_params</span><span class="p">,</span> <span class="n">y_min</span><span class="p">,</span> <span class="n">x_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_multigauss_fit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">I_data</span><span class="p">,</span> <span class="n">region_info</span><span class="p">)</span>
                <span class="n">gauss_params</span> <span class="o">=</span> <span class="n">gauss_params</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
                <span class="n">gauss_params</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">y_min</span>
                <span class="n">total_flux</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="n">gauss_params</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">gauss_params</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span>
                <span class="n">max_amplitude</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">gauss_params</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
                <span class="n">max_x</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">x_range</span><span class="p">)</span>
                <span class="n">min_x</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">x_range</span><span class="p">)</span>

            <span class="n">total_flux_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">total_flux</span><span class="p">)</span>
            <span class="n">max_amplitude_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">max_amplitude</span><span class="p">)</span>
            <span class="n">max_x_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">max_x</span><span class="p">)</span>
            <span class="n">min_x_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">min_x</span><span class="p">)</span>
        <span class="n">ar_info_part1</span> <span class="o">=</span> <span class="n">srs_table</span><span class="p">[[</span><span class="s1">&#39;RatanTime&#39;</span><span class="p">,</span> <span class="s1">&#39;Number&#39;</span><span class="p">,</span> <span class="s1">&#39;Mag Type&#39;</span><span class="p">,</span> <span class="s1">&#39;Number of Sunspots&#39;</span><span class="p">,</span> <span class="s1">&#39;Area&#39;</span><span class="p">,</span> <span class="s1">&#39;Z&#39;</span><span class="p">]]</span>
        <span class="n">ar_info_part2</span> <span class="o">=</span> <span class="n">Table</span><span class="p">([</span><span class="n">ar_numbers</span><span class="p">,</span> <span class="n">total_flux_list</span><span class="p">,</span> <span class="n">max_amplitude_list</span><span class="p">,</span> <span class="n">max_x_list</span><span class="p">,</span> <span class="n">min_x_list</span><span class="p">],</span>
                              <span class="n">names</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Number&#39;</span><span class="p">,</span> <span class="s1">&#39;TotalFlux&#39;</span><span class="p">,</span> <span class="s1">&#39;MaxAmplitude&#39;</span><span class="p">,</span> <span class="s1">&#39;MaxLat&#39;</span><span class="p">,</span> <span class="s1">&#39;MinLat&#39;</span><span class="p">))</span>
        <span class="n">ar_info</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">ar_info_part1</span><span class="p">,</span> <span class="n">ar_info_part2</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="s1">&#39;Number&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fits</span><span class="o">.</span><span class="n">HDUList</span><span class="p">([</span><span class="n">primary_hdu</span><span class="p">,</span> <span class="n">fits</span><span class="o">.</span><span class="n">BinTableHDU</span><span class="p">(</span><span class="n">ar_info</span><span class="p">)])</span></div>

    
<div class="viewcode-block" id="RATANClient.find_ar_intervals_using_peaks">
<a class="viewcode-back" href="../../../radiosunpy.client.html#radiosunpy.client.client.RATANClient.find_ar_intervals_using_peaks">[docs]</a>
    <span class="k">def</span> <span class="nf">find_ar_intervals_using_peaks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> 
                                    <span class="n">y</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> 
                                    <span class="n">ar_table</span><span class="p">:</span> <span class="n">Table</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Table</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Identify intervals around active region centers using peak detection</span>

<span class="sd">        :param x: Array of x-coordinates, typically representing time or position</span>
<span class="sd">        :type x: np.ndarray</span>
<span class="sd">        :param y: Array of y-coordinates, representing the signal intensity</span>
<span class="sd">        :type y: np.ndarray</span>
<span class="sd">        :param ar_table: Table with active region info, including &#39;Number&#39; and &#39;Latitude&#39;</span>
<span class="sd">        :type ar_table: Table</span>
<span class="sd">        :return: Table with active region numbers and calculated intervals</span>
<span class="sd">        :rtype: Table</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">peaks_indices</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">find_peaks</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">minima_indices</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">find_peaks</span><span class="p">(</span><span class="o">-</span><span class="n">y</span><span class="p">)</span>

        <span class="n">ar_intervals</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">number</span><span class="p">,</span> <span class="n">center_x</span> <span class="ow">in</span> <span class="n">ar_table</span><span class="p">[[</span><span class="s1">&#39;Number&#39;</span><span class="p">,</span> <span class="s1">&#39;Latitude&#39;</span><span class="p">]]:</span>
            <span class="n">peak_distances</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">peaks_indices</span><span class="p">]</span> <span class="o">-</span> <span class="n">center_x</span><span class="p">)</span>
            <span class="n">center_index</span> <span class="o">=</span> <span class="n">peaks_indices</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">peak_distances</span><span class="p">)]</span>

            <span class="n">left_minima</span> <span class="o">=</span> <span class="n">minima_indices</span><span class="p">[</span><span class="n">minima_indices</span> <span class="o">&lt;</span> <span class="n">center_index</span><span class="p">]</span>
            <span class="n">right_minima</span> <span class="o">=</span> <span class="n">minima_indices</span><span class="p">[</span><span class="n">minima_indices</span> <span class="o">&gt;</span> <span class="n">center_index</span><span class="p">]</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">left_minima</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">left_index</span> <span class="o">=</span> <span class="n">left_minima</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">left_index</span> <span class="o">=</span> <span class="mi">0</span> 

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">right_minima</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">right_index</span> <span class="o">=</span> <span class="n">right_minima</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">right_index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> 

            <span class="n">ar_interval</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">left_index</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="n">right_index</span><span class="p">])</span>
            <span class="n">ar_intervals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ar_interval</span><span class="p">)</span>

        <span class="n">ar_table_with_intervals</span> <span class="o">=</span> <span class="n">ar_table</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">ar_table_with_intervals</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="n">Column</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">ar_intervals</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Interval&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">ar_table_with_intervals</span></div>

    
<div class="viewcode-block" id="RATANClient.compute_fluxes">
<a class="viewcode-back" href="../../../radiosunpy.client.html#radiosunpy.client.client.RATANClient.compute_fluxes">[docs]</a>
    <span class="k">def</span> <span class="nf">compute_fluxes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> 
                       <span class="n">y</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> 
                       <span class="n">ar_table</span><span class="p">:</span> <span class="n">Table</span><span class="p">,</span> 
                       <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;I&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Table</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate fluxes for active regions over specified intervals.</span>

<span class="sd">        :param x: Array of x-coordinates, typically representing time or position.</span>
<span class="sd">        :type x: np.ndarray</span>
<span class="sd">        :param y: Array of y-coordinates, representing the signal intensity. Supports 2D arrays.</span>
<span class="sd">        :type y: np.ndarray</span>
<span class="sd">        :param ar_table: Table containing active region info, including &#39;Interval&#39;.</span>
<span class="sd">        :type ar_table: Table</span>
<span class="sd">        :param mode: Mode of flux calculation, defaults to &#39;I&#39;.</span>
<span class="sd">        :type mode: str</span>
<span class="sd">        :return: Table with active region info and calculated fluxes.</span>
<span class="sd">        :rtype: Table</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">cumulative_integral</span> <span class="o">=</span> <span class="n">cumulative_trapezoid</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">initial</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">cum_integral_interp</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">cumulative_integral</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">fill_value</span><span class="o">=</span><span class="s2">&quot;extrapolate&quot;</span><span class="p">,</span> <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>

        <span class="n">intervals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ar_table</span><span class="p">[</span><span class="s1">&#39;Interval&#39;</span><span class="p">])</span>
        <span class="n">left_x</span> <span class="o">=</span> <span class="n">intervals</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">right_x</span> <span class="o">=</span> <span class="n">intervals</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

        <span class="n">left_x</span><span class="p">,</span> <span class="n">right_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">left_x</span><span class="p">,</span> <span class="n">right_x</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">left_x</span><span class="p">,</span> <span class="n">right_x</span><span class="p">)</span>

        <span class="n">cum_int_left</span> <span class="o">=</span> <span class="n">cum_integral_interp</span><span class="p">(</span><span class="n">left_x</span><span class="p">)</span>
        <span class="n">cum_int_right</span> <span class="o">=</span> <span class="n">cum_integral_interp</span><span class="p">(</span><span class="n">right_x</span><span class="p">)</span>

        <span class="n">fluxes</span> <span class="o">=</span> <span class="p">(</span><span class="n">cum_int_right</span> <span class="o">-</span> <span class="n">cum_int_left</span><span class="p">)</span>

        <span class="n">col_name</span> <span class="o">=</span> <span class="s1">&#39;Flux_&#39;</span> <span class="o">+</span> <span class="n">mode</span>
        <span class="n">flux_column</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">fluxes</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">col_name</span><span class="p">)</span>
        <span class="n">ar_table_with_fluxes</span> <span class="o">=</span> <span class="n">ar_table</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">ar_table_with_fluxes</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="n">flux_column</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ar_table_with_fluxes</span></div>

    
<div class="viewcode-block" id="RATANClient.get_ar_info">
<a class="viewcode-back" href="../../../radiosunpy.client.html#radiosunpy.client.client.RATANClient.get_ar_info">[docs]</a>
    <span class="k">def</span> <span class="nf">get_ar_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                    <span class="n">pr_data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">fits</span><span class="o">.</span><span class="n">hdu</span><span class="o">.</span><span class="n">hdulist</span><span class="o">.</span><span class="n">HDUList</span><span class="p">],</span> 
                    <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Table</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve Extract active region information from processed FITS data.</span>
<span class="sd">        </span>
<span class="sd">        :param pr_data: Path to FITS file, URL, or FITS HDUList with processed data.</span>
<span class="sd">        :type pr_data: Union[str, fits.hdu.hdulist.HDUList]</span>
<span class="sd">        :param kwargs: Additional keyword arguments for processing options.</span>
<span class="sd">        :return: FITS HDUList containing frequency data and active region information.</span>
<span class="sd">        :rtype: Table</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pr_data</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">PosixPath</span><span class="p">,</span> <span class="n">fits</span><span class="o">.</span><span class="n">hdu</span><span class="o">.</span><span class="n">hdulist</span><span class="o">.</span><span class="n">HDUList</span><span class="p">)),</span> \
            <span class="s1">&#39;Processed data should be link to file, path to fits data of fits data&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pr_data</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">PosixPath</span><span class="p">)):</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">processed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_fits_data</span><span class="p">(</span><span class="n">pr_data</span><span class="p">,</span>
                                                  <span class="n">save_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                                  <span class="n">save_with_original</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">processed</span> <span class="o">=</span> <span class="n">pr_data</span>

        <span class="k">if</span> <span class="n">bad_freq</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">bad_freq</span> <span class="o">=</span> <span class="p">[</span><span class="mf">15.0938</span><span class="p">,</span> <span class="mf">15.2812</span><span class="p">,</span> <span class="mf">15.4688</span><span class="p">,</span> <span class="mf">15.6562</span><span class="p">,</span> <span class="mf">15.8438</span><span class="p">,</span> <span class="mf">16.0312</span><span class="p">,</span> <span class="mf">16.2188</span><span class="p">,</span> <span class="mf">16.4062</span><span class="p">]</span>

        <span class="n">srs_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">form_srstable_with_time_shift</span><span class="p">(</span><span class="n">processed</span><span class="p">)</span>

        <span class="n">CDELT1</span> <span class="o">=</span> <span class="n">processed</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;CDELT1&#39;</span><span class="p">]</span>
        <span class="n">CRPIX</span> <span class="o">=</span> <span class="n">processed</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;CRPIX1&#39;</span><span class="p">]</span>
        <span class="n">FREQ</span> <span class="o">=</span> <span class="n">processed</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
        <span class="n">bad_freq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">FREQ</span><span class="p">,</span> <span class="n">bad_freq</span><span class="p">)</span>
        <span class="n">I</span> <span class="o">=</span> <span class="n">processed</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
        <span class="n">V</span> <span class="o">=</span> <span class="n">processed</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">processed</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
        <span class="n">I</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">FREQ</span> <span class="o">=</span> <span class="n">I</span><span class="p">[</span><span class="o">~</span><span class="n">bad_freq</span><span class="p">],</span> <span class="n">V</span><span class="p">[</span><span class="o">~</span><span class="n">bad_freq</span><span class="p">],</span> <span class="n">FREQ</span><span class="p">[</span><span class="o">~</span><span class="n">bad_freq</span><span class="p">]</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
            <span class="o">-</span> <span class="n">CRPIX</span> <span class="o">*</span> <span class="n">CDELT1</span><span class="p">,</span>
            <span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">CRPIX</span><span class="p">)</span> <span class="o">*</span> <span class="n">CDELT1</span><span class="p">,</span>
            <span class="n">num</span><span class="o">=</span><span class="n">V</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="n">primary_hdu</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">PrimaryHDU</span><span class="p">(</span><span class="n">FREQ</span><span class="p">)</span>
        <span class="n">primary_hdu</span><span class="o">.</span><span class="n">header</span> <span class="o">=</span> <span class="n">processed</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span>
        
        <span class="n">ar_intervals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_ar_intervals_using_peaks</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">I</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">mask</span><span class="p">],</span> <span class="n">srs_table</span><span class="p">)</span>
        <span class="n">ar_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_fluxes</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">ar_intervals</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;I&#39;</span><span class="p">)</span>
        <span class="n">ar_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_fluxes</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">ar_intervals</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;V&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fits</span><span class="o">.</span><span class="n">HDUList</span><span class="p">([</span><span class="n">primary_hdu</span><span class="p">,</span> <span class="n">fits</span><span class="o">.</span><span class="n">BinTableHDU</span><span class="p">(</span><span class="n">ar_info</span><span class="p">)])</span></div>


<div class="viewcode-block" id="RATANClient.condition">
<a class="viewcode-back" href="../../../radiosunpy.client.html#radiosunpy.client.client.RATANClient.condition">[docs]</a>
    <span class="k">def</span> <span class="nf">condition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">data_match</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Formats the data string based on the year and month. Used in Scrapper class</span>
<span class="sd">        :param year: The year of the data.</span>
<span class="sd">        :type year: str</span>
<span class="sd">        :param month:</span>
<span class="sd">        :type month: str</span>
<span class="sd">        :param data_match: data text from http content</span>
<span class="sd">        :type data_match: str</span>
<span class="sd">        :return: string with selected data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">year</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2010</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">year</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2010</span> <span class="ow">and</span> <span class="nb">int</span><span class="p">(</span><span class="n">month</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">):</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">year</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span><span class="si">}{</span><span class="n">data_match</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">data_match</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">data_match</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">data_match</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">data_match</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">data_match</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span><span class="si">}</span><span class="s1">&#39;</span></div>


<div class="viewcode-block" id="RATANClient.filter">
<a class="viewcode-back" href="../../../radiosunpy.client.html#radiosunpy.client.client.RATANClient.filter">[docs]</a>
    <span class="k">def</span> <span class="nf">filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url_list</span><span class="p">):</span>
        <span class="k">pass</span></div>


<div class="viewcode-block" id="RATANClient.convolve_sun">
<a class="viewcode-back" href="../../../radiosunpy.client.html#radiosunpy.client.client.RATANClient.convolve_sun">[docs]</a>
    <span class="nd">@lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">convolve_sun</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sigma_horiz</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">sigma_vert</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">R</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;    Performs convolution of the Sun model with Gaussian and rectangular functions.</span>

<span class="sd">        :param sigma_horiz:</span>
<span class="sd">        :type sigma_horiz: float</span>
<span class="sd">        :param sigma_vert:</span>
<span class="sd">        :type sigma_vert: float</span>
<span class="sd">        :param R:</span>
<span class="sd">        :type R: float</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">size</span> <span class="o">=</span> <span class="mi">1000</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">size</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">size</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">size</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">size</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
        <span class="n">gaussian</span> <span class="o">=</span> <span class="n">gauss2d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sigma_horiz</span><span class="p">,</span> <span class="n">sigma_vert</span><span class="p">)</span>
        <span class="n">rectangle</span> <span class="o">=</span> <span class="n">create_rectangle</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">sigma_horiz</span><span class="p">,</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">R</span><span class="p">)</span>
        <span class="n">sun_model</span> <span class="o">=</span> <span class="n">create_sun_model</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">R</span><span class="p">)</span>
        <span class="c1"># Perform convolutions</span>
        <span class="n">convolved_gaussian</span> <span class="o">=</span> <span class="n">fftconvolve</span><span class="p">(</span><span class="n">sun_model</span><span class="p">,</span> <span class="n">gaussian</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">gaussian</span><span class="p">)</span>
        <span class="n">convolved_rectangle</span> <span class="o">=</span> <span class="n">fftconvolve</span><span class="p">(</span><span class="n">sun_model</span><span class="p">,</span> <span class="n">rectangle</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rectangle</span><span class="p">)</span>

        <span class="n">convolved_gaussian</span> <span class="o">=</span> <span class="n">convolved_gaussian</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">convolved_gaussian</span><span class="p">)</span>
        <span class="n">convolved_rectangle</span> <span class="o">=</span> <span class="n">convolved_rectangle</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">convolved_rectangle</span><span class="p">)</span>

        <span class="n">conv_g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">convolved_gaussian</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">conv_r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">convolved_rectangle</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="c1"># Calculate areas under the curve</span>
        <span class="n">area_gaussian</span> <span class="o">=</span> <span class="n">calculate_area</span><span class="p">(</span><span class="n">conv_g</span><span class="p">)</span>
        <span class="n">area_rectangle</span> <span class="o">=</span> <span class="n">calculate_area</span><span class="p">(</span><span class="n">conv_r</span><span class="p">)</span>
        <span class="c1"># Division of areas</span>
        <span class="n">area_ratio</span> <span class="o">=</span> <span class="n">area_gaussian</span> <span class="o">/</span> <span class="n">area_rectangle</span>
        <span class="k">return</span> <span class="n">area_ratio</span></div>


<div class="viewcode-block" id="RATANClient.antenna_efficiency">
<a class="viewcode-back" href="../../../radiosunpy.client.html#radiosunpy.client.client.RATANClient.antenna_efficiency">[docs]</a>
    <span class="k">def</span> <span class="nf">antenna_efficiency</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">freq</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="n">R</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates the antenna efficiency for each frequency.</span>

<span class="sd">        :param freq:</span>
<span class="sd">        :param R:</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">areas</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">freq</span><span class="p">:</span>
            <span class="n">lambda_value</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="mi">8</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">f</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="mi">9</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span>
            <span class="n">FWHM_h</span> <span class="o">=</span> <span class="mf">0.85</span> <span class="o">*</span> <span class="n">lambda_value</span>
            <span class="n">FWHM_v</span> <span class="o">=</span> <span class="mf">0.75</span> <span class="o">*</span> <span class="n">lambda_value</span> <span class="o">*</span> <span class="mi">60</span>

            <span class="n">sigma_h</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">bwhm_to_sigma</span><span class="p">(</span><span class="n">FWHM_h</span><span class="p">),</span> <span class="mi">9</span><span class="p">)</span>
            <span class="n">sigma_v</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">bwhm_to_sigma</span><span class="p">(</span><span class="n">FWHM_v</span><span class="p">),</span> <span class="mi">9</span><span class="p">)</span>

            <span class="n">area_ratio</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convolve_sun</span><span class="p">(</span><span class="n">sigma_h</span><span class="p">,</span> <span class="n">sigma_v</span><span class="p">,</span> <span class="n">R</span><span class="p">)</span>
            <span class="n">areas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">area_ratio</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">areas</span></div>


<div class="viewcode-block" id="RATANClient.calibrate_QSModel">
<a class="viewcode-back" href="../../../radiosunpy.client.html#radiosunpy.client.client.RATANClient.calibrate_QSModel">[docs]</a>
    <span class="k">def</span> <span class="nf">calibrate_QSModel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">scan_data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                          <span class="n">solar_r</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">frequency</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                          <span class="n">flux_eficiency</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calibrates raw scan data with the quiet Sun model.</span>
<span class="sd">        :param x: Array of x coordinates</span>
<span class="sd">        :type: np.ndarray</span>
<span class="sd">        :param scan_data: Scan data array.</span>
<span class="sd">        :type: np.ndarray</span>
<span class="sd">        :param solar_r:  Solar radius in arcseconds</span>
<span class="sd">        :type: float</span>
<span class="sd">        :param frequency: Array of frequencies.</span>
<span class="sd">        :type: np.ndarray</span>
<span class="sd">        :param flux_eficiency: Array of flux efficiencies for each frequency.</span>
<span class="sd">        :type: np.ndarray</span>
<span class="sd">        :return: calibrated scan: mask, Stocks component I, Stocks component V</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">K_b</span> <span class="o">=</span> <span class="mf">1.38</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mi">23</span><span class="p">)</span>  <span class="c1"># Boltzmann constant</span>
        <span class="n">c</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="mi">8</span>  <span class="c1"># Speed of light in vacuum</span>
        <span class="n">freq_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">frequency</span><span class="p">)</span>
        <span class="n">model_freq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convolution_template</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">template_freq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">quiet_sun_model</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span>
        <span class="n">template_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">quiet_sun_model</span><span class="p">[</span><span class="s1">&#39;T_brightness&#39;</span><span class="p">]</span>
        <span class="n">real_brightness</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">template_freq</span><span class="p">,</span> <span class="n">template_val</span><span class="p">,</span> <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="s2">&quot;extrapolate&quot;</span><span class="p">)</span>
        <span class="n">full_flux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">([</span>
            <span class="n">frequency</span><span class="p">,</span>
            <span class="mi">2</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="mi">22</span> <span class="o">*</span> <span class="n">K_b</span> <span class="o">*</span> <span class="n">real_brightness</span><span class="p">(</span><span class="n">frequency</span><span class="p">)</span> <span class="o">*</span> <span class="n">SunSolidAngle</span><span class="p">(</span><span class="n">solar_r</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">c</span> <span class="o">/</span> <span class="p">(</span><span class="n">frequency</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="mi">9</span><span class="p">))</span> <span class="o">**</span> <span class="p">(</span>
                <span class="o">-</span><span class="mi">2</span><span class="p">)</span>
        <span class="p">])</span>

        <span class="n">R</span> <span class="o">=</span> <span class="n">scan_data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">+</span> <span class="n">scan_data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">L</span> <span class="o">=</span> <span class="n">scan_data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">scan_data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>

        <span class="n">columns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convolution_template</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">solar_r</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">solar_r</span><span class="p">)</span>

        <span class="n">calibrated_R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">freq_size</span><span class="p">,</span> <span class="n">R</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">calibrated_L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">freq_size</span><span class="p">,</span> <span class="n">L</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">theoretical_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">freq_size</span><span class="p">,</span> <span class="n">L</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">freq_num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">freq_size</span><span class="p">):</span>
            <span class="n">real_R</span><span class="p">,</span> <span class="n">real_L</span> <span class="o">=</span> <span class="n">R</span><span class="p">[</span><span class="n">freq_num</span><span class="p">],</span> <span class="n">L</span><span class="p">[</span><span class="n">freq_num</span><span class="p">]</span>
            <span class="n">freq_diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">columns</span> <span class="o">-</span> <span class="n">frequency</span><span class="p">[</span><span class="n">freq_num</span><span class="p">])</span>
            <span class="n">freq_template</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">freq_diff</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="n">template_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convolution_template</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="n">freq_template</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">x_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convolution_template</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

            <span class="n">convolution_template_arcsec</span> <span class="o">=</span> <span class="n">flip_and_concat</span><span class="p">(</span><span class="n">template_values</span><span class="p">)</span>
            <span class="n">x_arcsec</span> <span class="o">=</span> <span class="n">flip_and_concat</span><span class="p">(</span><span class="n">x_values</span><span class="p">,</span> <span class="n">flip_values</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="n">coeff</span> <span class="o">=</span> <span class="n">full_flux</span><span class="p">[</span><span class="n">freq_num</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">flux_eficiency</span><span class="p">[</span><span class="n">freq_num</span><span class="p">]</span> <span class="o">/</span> <span class="n">trapezoid</span><span class="p">(</span><span class="n">convolution_template_arcsec</span><span class="p">,</span> <span class="n">x_arcsec</span><span class="p">)</span>
            <span class="n">theoretical_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x_arcsec</span><span class="p">,</span> <span class="n">coeff</span> <span class="o">*</span> <span class="n">convolution_template_arcsec</span><span class="p">)</span>
            <span class="n">theoretical_new</span><span class="p">[</span><span class="n">freq_num</span><span class="p">]</span> <span class="o">=</span> <span class="n">theoretical_data</span>

            <span class="n">res_R</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">]),</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">real_R</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">theoretical_data</span><span class="p">[</span><span class="n">mask</span><span class="p">]))</span>
            <span class="n">res_L</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">]),</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">real_L</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">theoretical_data</span><span class="p">[</span><span class="n">mask</span><span class="p">]))</span>

            <span class="n">calibrated_R</span><span class="p">[</span><span class="n">freq_num</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">real_R</span> <span class="o">*</span> <span class="n">res_R</span><span class="o">.</span><span class="n">x</span>
            <span class="n">calibrated_L</span><span class="p">[</span><span class="n">freq_num</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">real_L</span> <span class="o">*</span> <span class="n">res_L</span><span class="o">.</span><span class="n">x</span>
        <span class="k">return</span> <span class="n">mask</span><span class="p">,</span> <span class="p">(</span><span class="n">calibrated_R</span> <span class="o">+</span> <span class="n">calibrated_L</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">calibrated_R</span> <span class="o">-</span> <span class="n">calibrated_L</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span></div>


<div class="viewcode-block" id="RATANClient.heliocentric_transform">
<a class="viewcode-back" href="../../../radiosunpy.client.html#radiosunpy.client.client.RATANClient.heliocentric_transform">[docs]</a>
    <span class="k">def</span> <span class="nf">heliocentric_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Lat</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Long</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                               <span class="n">SOLAR_R</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">SOLAR_B</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Transforms solar coordinates to a heliocentric system.</span>
<span class="sd">        :param Lat:  Latitude array in degrees</span>
<span class="sd">        :type: np.ndarray</span>
<span class="sd">        :param Long: Longitude array in degrees</span>
<span class="sd">        :type: np.ndarray</span>
<span class="sd">        :param SOLAR_R:  Solar radius.</span>
<span class="sd">        :type: float</span>
<span class="sd">        :param SOLAR_B: Solar B angle</span>
<span class="sd">        :type: float</span>
<span class="sd">        :return: Heliocentric x and y coordinates.</span>
<span class="sd">        :rtype: Tuple[np.ndarray, np.ndarray]</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">SOLAR_R</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Lat</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Long</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">),</span>
            <span class="n">SOLAR_R</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Lat</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">SOLAR_B</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)</span>
                       <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Lat</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Long</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">SOLAR_B</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">))</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="RATANClient.pozitional_rotation">
<a class="viewcode-back" href="../../../radiosunpy.client.html#radiosunpy.client.client.RATANClient.pozitional_rotation">[docs]</a>
    <span class="k">def</span> <span class="nf">pozitional_rotation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Lat</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Long</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                            <span class="n">angle</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Rotates positional data by a given angle.</span>

<span class="sd">        :param Lat:  Latitude array in degrees</span>
<span class="sd">        :type: np.ndarray</span>
<span class="sd">        :param Long: Longitude array in degrees</span>
<span class="sd">        :type: np.ndarray</span>
<span class="sd">        :param angle:    Rotation angle in degrees.</span>
<span class="sd">        :type: float</span>
<span class="sd">        :return: Rotated X and Y coordinates</span>
<span class="sd">        :rtype: Tuple[np.ndarray, np.ndarray]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">Lat</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)</span> <span class="o">-</span> <span class="n">Long</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">),</span>
            <span class="n">Lat</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)</span> <span class="o">+</span> <span class="n">Long</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="RATANClient.differential_rotation">
<a class="viewcode-back" href="../../../radiosunpy.client.html#radiosunpy.client.client.RATANClient.differential_rotation">[docs]</a>
    <span class="k">def</span> <span class="nf">differential_rotation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Lat</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates the differential rotation of the Sun based on latitude.</span>
<span class="sd">        :param Lat:  Latitude array in degrees</span>
<span class="sd">        :type: np.ndarray</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">A</span> <span class="o">=</span> <span class="mf">14.713</span>
        <span class="n">B</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.396</span>
        <span class="n">C</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.787</span>
        <span class="k">return</span> <span class="n">A</span> <span class="o">+</span> <span class="n">B</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Lat</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">C</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Lat</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)</span> <span class="o">**</span> <span class="mi">4</span></div>


<div class="viewcode-block" id="RATANClient.pozitional_angle">
<a class="viewcode-back" href="../../../radiosunpy.client.html#radiosunpy.client.client.RATANClient.pozitional_angle">[docs]</a>
    <span class="k">def</span> <span class="nf">pozitional_angle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">AZIMUTH</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">SOL_DEC</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">SOLAR_P</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">         Calculates the positional angle of the sun based on azimuth, solar declination, and solar P-angle.</span>
<span class="sd">        :param AZIMUTH: Azimuth angle.</span>
<span class="sd">        :type: float</span>
<span class="sd">        :param SOL_DEC:  Solar declination angle.</span>
<span class="sd">        :type: float</span>
<span class="sd">        :param SOLAR_P: Solar P-angle</span>
<span class="sd">        :type: float</span>
<span class="sd">        :return: Positional angle of the sun</span>
<span class="sd">        :rtype: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">q</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">AZIMUTH</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">SOL_DEC</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">))</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">SOLAR_P</span> <span class="o">+</span> <span class="mf">360.0</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">SOLAR_P</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">30</span> <span class="k">else</span> <span class="n">SOLAR_P</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">q</span><span class="p">)</span></div>


<div class="viewcode-block" id="RATANClient.form_srstable_with_time_shift">
<a class="viewcode-back" href="../../../radiosunpy.client.html#radiosunpy.client.client.RATANClient.form_srstable_with_time_shift">[docs]</a>
    <span class="k">def</span> <span class="nf">form_srstable_with_time_shift</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">processed_file</span><span class="p">:</span> <span class="n">fits</span><span class="o">.</span><span class="n">HDUList</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Table</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Create table with AR info with SRSClient</span>
<span class="sd">        with correct NOAA coordinates for RATAN time difference</span>

<span class="sd">        :param processed_file:  calibrate RATAN fits</span>
<span class="sd">        :type: fits.HDUList</span>
<span class="sd">        :return: modified NOAA table with ARs</span>
<span class="sd">        :rtype: Table</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">SOLAR_R</span> <span class="o">=</span> <span class="n">processed_file</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;SOLAR_R&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1.01175</span>
        <span class="n">SOLAR_B</span> <span class="o">=</span> <span class="n">processed_file</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;SOLAR_B&#39;</span><span class="p">]</span>
        <span class="n">OBS_DATE</span> <span class="o">=</span> <span class="n">processed_file</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;DATE-OBS&#39;</span><span class="p">]</span>
        <span class="n">OBS_TIME</span> <span class="o">=</span> <span class="n">processed_file</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;TIME-OBS&#39;</span><span class="p">]</span>

        <span class="n">AZIMUTH</span> <span class="o">=</span> <span class="n">processed_file</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;AZIMUTH&#39;</span><span class="p">]</span>
        <span class="n">SOL_DEC</span> <span class="o">=</span> <span class="n">processed_file</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;SOL_DEC&#39;</span><span class="p">]</span>
        <span class="n">SOLAR_P</span> <span class="o">=</span> <span class="n">processed_file</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;SOLAR_P&#39;</span><span class="p">]</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pozitional_angle</span><span class="p">(</span><span class="n">AZIMUTH</span><span class="p">,</span> <span class="n">SOL_DEC</span><span class="p">,</span> <span class="n">SOLAR_P</span><span class="p">)</span>
        <span class="n">ratan_datetime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">OBS_DATE</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">OBS_TIME</span><span class="p">,</span> <span class="s1">&#39;%Y/%m/</span><span class="si">%d</span><span class="s1"> %H:%M:%S.</span><span class="si">%f</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">ratan_datetime_str</span> <span class="o">=</span> <span class="n">ratan_datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y/%m/</span><span class="si">%d</span><span class="s1"> %H:%M&#39;</span><span class="p">)</span>
        <span class="n">noaa_datetime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">OBS_DATE</span><span class="p">,</span> <span class="s1">&#39;%Y/%m/</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">diff_hours</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">ratan_datetime</span> <span class="o">-</span> <span class="n">noaa_datetime</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">/</span> <span class="mi">3600</span><span class="p">)</span>

        <span class="n">srs</span> <span class="o">=</span> <span class="n">SRSClient</span><span class="p">()</span>
        <span class="n">srs_table</span> <span class="o">=</span> <span class="n">srs</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">TimeRange</span><span class="p">(</span><span class="n">OBS_DATE</span><span class="p">,</span> <span class="n">OBS_DATE</span><span class="p">))</span>
        <span class="n">srs_table</span> <span class="o">=</span> <span class="n">srs_table</span><span class="p">[</span><span class="n">srs_table</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;I&#39;</span><span class="p">]</span>
        <span class="n">len_tbl</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">srs_table</span><span class="p">)</span>
        <span class="n">srs_table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;RatanTime&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">ratan_datetime_str</span><span class="p">]</span> <span class="o">*</span> <span class="n">len_tbl</span><span class="p">))</span>
        <span class="n">srs_table</span><span class="p">[</span><span class="s1">&#39;Longitude&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">srs_table</span><span class="p">[</span><span class="s1">&#39;Longitude&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">differential_rotation</span><span class="p">(</span><span class="n">srs_table</span><span class="p">[</span><span class="s1">&#39;Latitude&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="n">diff_hours</span> <span class="o">/</span> <span class="mi">24</span>
        <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

        <span class="n">srs_table</span><span class="p">[</span><span class="s1">&#39;Latitude&#39;</span><span class="p">],</span> <span class="n">srs_table</span><span class="p">[</span><span class="s1">&#39;Longitude&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">heliocentric_transform</span><span class="p">(</span>
            <span class="n">srs_table</span><span class="p">[</span><span class="s1">&#39;Latitude&#39;</span><span class="p">],</span>
            <span class="n">srs_table</span><span class="p">[</span><span class="s1">&#39;Longitude&#39;</span><span class="p">],</span>
            <span class="n">SOLAR_R</span><span class="p">,</span>
            <span class="n">SOLAR_B</span>
        <span class="p">)</span>

        <span class="n">srs_table</span><span class="p">[</span><span class="s1">&#39;Latitude&#39;</span><span class="p">],</span> <span class="n">srs_table</span><span class="p">[</span><span class="s1">&#39;Longitude&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pozitional_rotation</span><span class="p">(</span>
            <span class="n">srs_table</span><span class="p">[</span><span class="s1">&#39;Latitude&#39;</span><span class="p">],</span>
            <span class="n">srs_table</span><span class="p">[</span><span class="s1">&#39;Longitude&#39;</span><span class="p">],</span>
            <span class="n">angle</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">srs_table</span></div>


<div class="viewcode-block" id="RATANClient.active_regions_search">
<a class="viewcode-back" href="../../../radiosunpy.client.html#radiosunpy.client.client.RATANClient.active_regions_search">[docs]</a>
    <span class="k">def</span> <span class="nf">active_regions_search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">srs</span><span class="p">:</span> <span class="n">Table</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">V</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">mask</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">         Searches for active regions in the solar spectrum data using wavelet denoising and peak detection</span>
<span class="sd">         and matching with NOAA active location.</span>
<span class="sd">        :param srs: table from SRSCLient with informations about the NOAA active regions.</span>
<span class="sd">        :param x: x coordinates</span>
<span class="sd">        :param V: Stocks vector V</span>
<span class="sd">        :param mask: masked interval</span>
<span class="sd">        :return: Table with active regions: V value and coordinate for center of AR</span>
<span class="sd">        :rtype: Table</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
        <span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">V</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="n">mask</span><span class="p">]</span>

        <span class="n">wavelet</span> <span class="o">=</span> <span class="s1">&#39;sym6&#39;</span>  <span class="c1"># Daubechies wavelet</span>
        <span class="n">level</span> <span class="o">=</span> <span class="mi">4</span>  <span class="c1"># Level of decomposition</span>
        <span class="n">denoised_data</span> <span class="o">=</span> <span class="n">wavelet_denoise</span><span class="p">(</span><span class="n">V</span><span class="p">,</span> <span class="n">wavelet</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span>
        <span class="n">height_threshold</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="c1"># Finding peaks in the denoised data</span>
        <span class="n">peaks</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">find_peaks</span><span class="p">(</span><span class="n">denoised_data</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">height_threshold</span><span class="p">(</span><span class="n">denoised_data</span><span class="p">))</span>
        <span class="n">valleys</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">find_peaks</span><span class="p">(</span><span class="o">-</span><span class="n">denoised_data</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">height_threshold</span><span class="p">(</span><span class="o">-</span><span class="n">denoised_data</span><span class="p">))</span>
        <span class="n">extremums</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">peaks</span><span class="p">,</span> <span class="n">valleys</span><span class="p">))</span>

        <span class="n">theoretical_latitudes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">srs</span><span class="p">[</span><span class="s1">&#39;Latitude&#39;</span><span class="p">])</span>
        <span class="n">experimental_latitudes</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">extremums</span><span class="p">]</span>
        <span class="n">abs_diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">experimental_latitudes</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> <span class="o">-</span> <span class="n">theoretical_latitudes</span><span class="p">)</span>
        <span class="n">min_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">abs_diff</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">closest_data</span> <span class="o">=</span> <span class="n">srs</span><span class="p">[</span><span class="n">min_index</span><span class="p">]</span>
        <span class="n">closest_data</span><span class="p">[</span><span class="s1">&#39;Latitude&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">experimental_latitudes</span>

        <span class="n">original_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">extremums_original</span> <span class="o">=</span> <span class="n">original_indices</span><span class="p">[</span><span class="n">extremums</span><span class="p">]</span>
        <span class="n">closest_data</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Data Index&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">extremums_original</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;i4&#39;</span><span class="p">)),</span> <span class="n">index</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">closest_data</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Masked Index&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">extremums</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;i4&#39;</span><span class="p">)),</span> <span class="n">index</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">closest_data</span></div>


<div class="viewcode-block" id="RATANClient.make_multigauss_fit">
<a class="viewcode-back" href="../../../radiosunpy.client.html#radiosunpy.client.client.RATANClient.make_multigauss_fit">[docs]</a>
    <span class="k">def</span> <span class="nf">make_multigauss_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                            <span class="n">peak_info</span><span class="p">:</span> <span class="n">Table</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fits multiple Gaussian functions to detected peaks.</span>
<span class="sd">        :param x: x values of the data.</span>
<span class="sd">        :type: np.ndarray</span>
<span class="sd">        :param y: y values of the data.</span>
<span class="sd">        :type: np.ndarray</span>
<span class="sd">        :param peak_info:  astropy Table with information about peaks.</span>
<span class="sd">        :return: width, value and coordinate for center of AR.</span>
<span class="sd">        :rtype: Tuple[float, float, float]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">min_lat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">peak_info</span><span class="p">[</span><span class="s1">&#39;Latitude&#39;</span><span class="p">])</span>
        <span class="n">max_lat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">peak_info</span><span class="p">[</span><span class="s1">&#39;Latitude&#39;</span><span class="p">])</span>
        <span class="n">indexes</span> <span class="o">=</span> <span class="n">peak_info</span><span class="p">[</span><span class="s1">&#39;Data Index&#39;</span><span class="p">]</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="n">min_lat</span> <span class="o">-</span> <span class="mi">50</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">max_lat</span> <span class="o">+</span> <span class="mi">50</span><span class="p">)</span>
        <span class="n">x_masked</span><span class="p">,</span> <span class="n">y_masked</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
        <span class="n">y_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">y_masked</span><span class="p">)</span>
        <span class="n">ar_info</span> <span class="o">=</span> <span class="p">[[</span><span class="n">y</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">-</span> <span class="n">y_min</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">index</span><span class="p">]]</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">indexes</span><span class="p">]</span>
        <span class="n">widths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">peak_info</span><span class="p">))</span>
        <span class="n">initial_guesses</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">ar_info</span><span class="p">,</span> <span class="n">widths</span><span class="p">)))</span>
        <span class="n">params</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">leastsq</span><span class="p">(</span><span class="n">gaussian_mixture</span><span class="p">,</span> <span class="n">initial_guesses</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">x_masked</span><span class="p">,</span> <span class="n">y_masked</span> <span class="o">-</span> <span class="n">y_min</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">params</span><span class="p">),</span> <span class="n">y_min</span><span class="p">,</span> <span class="n">x_masked</span></div>


<div class="viewcode-block" id="RATANClient.gauss_analysis">
<a class="viewcode-back" href="../../../radiosunpy.client.html#radiosunpy.client.client.RATANClient.gauss_analysis">[docs]</a>
    <span class="k">def</span> <span class="nf">gauss_analysis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">scan_data</span><span class="p">,</span> <span class="n">ar_info</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Analyzes active regions by fitting Gaussian functions and calculating associated metrics.</span>
<span class="sd">        :param x: x coordinates of the data (arcsec).</span>
<span class="sd">        :param scan_data:  scan with radio data</span>
<span class="sd">        :type: np.ndarray</span>
<span class="sd">        :param ar_info: Table with information about active regions.</span>
<span class="sd">        :type: Table</span>
<span class="sd">        :return: Table with ARs parameters from Radio data at each frequency</span>
<span class="sd">        :rtype: Table</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ar_number</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">ar_info</span><span class="p">[</span><span class="s1">&#39;Number&#39;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">noaa_ar</span> <span class="ow">in</span> <span class="n">ar_number</span><span class="p">:</span>
            <span class="n">region_info</span> <span class="o">=</span> <span class="n">ar_info</span><span class="p">[</span><span class="n">ar_info</span><span class="p">[</span><span class="s1">&#39;Number&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">noaa_ar</span><span class="p">]</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ar_info</span><span class="p">[</span><span class="s1">&#39;Number&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">noaa_ar</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">elem</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">scan_data</span><span class="p">):</span>
                <span class="n">freq</span><span class="p">,</span> <span class="n">I_data</span><span class="p">,</span> <span class="n">V_data</span> <span class="o">=</span> <span class="n">elem</span>
                <span class="n">gauss_params</span><span class="p">,</span> <span class="n">y_min</span><span class="p">,</span> <span class="n">x_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_multigauss_fit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">I_data</span><span class="p">,</span> <span class="n">region_info</span><span class="p">)</span>
                <span class="n">gauss_params</span> <span class="o">=</span> <span class="n">gauss_params</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
                <span class="n">gauss_params</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">y_min</span>
                <span class="n">total_flux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="n">gauss_params</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">gauss_params</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">local_index</span><span class="p">,</span> <span class="n">gaussian</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">gauss_params</span><span class="p">):</span>
                    <span class="n">amplitude</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">stddev</span> <span class="o">=</span> <span class="n">gaussian</span>
                    <span class="n">ar_info</span><span class="p">[</span><span class="s1">&#39;Amplitude&#39;</span><span class="p">][</span><span class="n">local_index</span><span class="p">][</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;freq&#39;</span><span class="p">:</span> <span class="n">freq</span><span class="p">,</span> <span class="s1">&#39;amplitude&#39;</span><span class="p">:</span> <span class="n">amplitude</span><span class="p">}</span>
                    <span class="n">ar_info</span><span class="p">[</span><span class="s1">&#39;Mean&#39;</span><span class="p">][</span><span class="n">local_index</span><span class="p">][</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;freq&#39;</span><span class="p">:</span> <span class="n">freq</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">:</span> <span class="n">mean</span><span class="p">}</span>
                    <span class="n">ar_info</span><span class="p">[</span><span class="s1">&#39;Sigma&#39;</span><span class="p">][</span><span class="n">local_index</span><span class="p">][</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;freq&#39;</span><span class="p">:</span> <span class="n">freq</span><span class="p">,</span> <span class="s1">&#39;sigma&#39;</span><span class="p">:</span> <span class="n">stddev</span><span class="p">}</span>
                    <span class="n">ar_info</span><span class="p">[</span><span class="s1">&#39;FWHM&#39;</span><span class="p">][</span><span class="n">local_index</span><span class="p">][</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;freq&#39;</span><span class="p">:</span> <span class="n">freq</span><span class="p">,</span> <span class="s1">&#39;fwhm&#39;</span><span class="p">:</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="n">stddev</span><span class="p">}</span>
                    <span class="n">ar_info</span><span class="p">[</span><span class="s1">&#39;Range&#39;</span><span class="p">][</span><span class="n">local_index</span><span class="p">][</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;freq&#39;</span><span class="p">:</span> <span class="n">freq</span><span class="p">,</span> <span class="s1">&#39;x_range&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">x_range</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">x_range</span><span class="p">))}</span>
                    <span class="n">ar_info</span><span class="p">[</span><span class="s1">&#39;Flux&#39;</span><span class="p">][</span><span class="n">local_index</span><span class="p">][</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;freq&#39;</span><span class="p">:</span> <span class="n">freq</span><span class="p">,</span>
                                                           <span class="s1">&#39;flux&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="n">amplitude</span> <span class="o">*</span> <span class="n">stddev</span><span class="p">}</span>
                    <span class="n">ar_info</span><span class="p">[</span><span class="s1">&#39;Total Flux&#39;</span><span class="p">][</span><span class="n">local_index</span><span class="p">][</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;freq&#39;</span><span class="p">:</span> <span class="n">freq</span><span class="p">,</span> <span class="s1">&#39;flux&#39;</span><span class="p">:</span> <span class="n">total_flux</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">ar_info</span></div>


<div class="viewcode-block" id="RATANClient.acquire_data">
<a class="viewcode-back" href="../../../radiosunpy.client.html#radiosunpy.client.client.RATANClient.acquire_data">[docs]</a>
    <span class="k">def</span> <span class="nf">acquire_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timerange</span><span class="p">:</span> <span class="n">TimeRange</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get all available urls for predefined TimeRange</span>
<span class="sd">        :param timerange: timerange for scan searching</span>
<span class="sd">        :type: TimeRange</span>
<span class="sd">        :return: url list:</span>
<span class="sd">        :rtype:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">scrapper</span> <span class="o">=</span> <span class="n">Scrapper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="p">,</span> <span class="n">regex_pattern</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">regex_pattern</span><span class="p">,</span>
                            <span class="n">condition</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">condition</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">scrapper</span><span class="o">.</span><span class="n">form_fileslist</span><span class="p">(</span><span class="n">timerange</span><span class="p">)</span></div>


<div class="viewcode-block" id="RATANClient.get_scans">
<a class="viewcode-back" href="../../../radiosunpy.client.html#radiosunpy.client.client.RATANClient.get_scans">[docs]</a>
    <span class="k">def</span> <span class="nf">get_scans</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timerange</span><span class="p">):</span>
        <span class="n">file_urls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">acquire_data</span><span class="p">(</span><span class="n">timerange</span><span class="p">)</span>
        <span class="n">column_types</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Date&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;U10&#39;</span><span class="p">),</span>
            <span class="s1">&#39;Time&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;U8&#39;</span><span class="p">),</span>
            <span class="s1">&#39;Azimuth&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;i2&#39;</span><span class="p">),</span>
            <span class="s1">&#39;SOLAR_R&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float64&#39;</span><span class="p">),</span>
            <span class="s1">&#39;N_shape&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;i4&#39;</span><span class="p">),</span>
            <span class="s1">&#39;CRPIX&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float64&#39;</span><span class="p">),</span>
            <span class="s1">&#39;CDELT1&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float64&#39;</span><span class="p">),</span>
            <span class="s1">&#39;Pozitional Angle&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float64&#39;</span><span class="p">),</span>
            <span class="s1">&#39;SOLAR_B&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float64&#39;</span><span class="p">),</span>
            <span class="s1">&#39;Frequency&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;O&#39;</span><span class="p">),</span>
            <span class="s1">&#39;Flux Eficiency &#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;O&#39;</span><span class="p">),</span>
            <span class="s1">&#39;I&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;O&#39;</span><span class="p">),</span>
            <span class="s1">&#39;V&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;O&#39;</span><span class="p">),</span>
        <span class="p">}</span>

        <span class="n">table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="n">names</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span><span class="n">column_types</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span><span class="n">column_types</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
        <span class="k">for</span> <span class="n">file_url</span> <span class="ow">in</span> <span class="n">file_urls</span><span class="p">:</span>
            <span class="n">hdul</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file_url</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>

            <span class="n">CDELT1</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;CDELT1&#39;</span><span class="p">]</span>
            <span class="n">CRPIX</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;CRPIX1&#39;</span><span class="p">]</span>
            <span class="n">SOLAR_R</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;SOLAR_R&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1.01175</span>
            <span class="n">SOLAR_B</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;SOLAR_B&#39;</span><span class="p">]</span>
            <span class="n">FREQ</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;FREQ&#39;</span><span class="p">]</span>
            <span class="n">OBS_DATE</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;DATE-OBS&#39;</span><span class="p">]</span>
            <span class="n">OBS_TIME</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;TIME-OBS&#39;</span><span class="p">]</span>
            <span class="n">bad_freq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">FREQ</span><span class="p">,</span> <span class="p">[</span><span class="mf">15.0938</span><span class="p">,</span> <span class="mf">15.2812</span><span class="p">,</span> <span class="mf">15.4688</span><span class="p">,</span> <span class="mf">15.6562</span><span class="p">,</span> <span class="mf">15.8438</span><span class="p">,</span> <span class="mf">16.0312</span><span class="p">,</span> <span class="mf">16.2188</span><span class="p">,</span> <span class="mf">16.4062</span><span class="p">])</span>

            <span class="n">AZIMUTH</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;AZIMUTH&#39;</span><span class="p">]</span>
            <span class="n">SOL_DEC</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;SOL_DEC&#39;</span><span class="p">]</span>
            <span class="n">SOLAR_P</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;SOLAR_P&#39;</span><span class="p">]</span>
            <span class="n">angle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pozitional_angle</span><span class="p">(</span><span class="n">AZIMUTH</span><span class="p">,</span> <span class="n">SOL_DEC</span><span class="p">,</span> <span class="n">SOLAR_P</span><span class="p">)</span>
            <span class="n">N_shape</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
                <span class="o">-</span> <span class="n">CRPIX</span> <span class="o">*</span> <span class="n">CDELT1</span><span class="p">,</span>
                <span class="p">(</span><span class="n">N_shape</span> <span class="o">-</span> <span class="n">CRPIX</span><span class="p">)</span> <span class="o">*</span> <span class="n">CDELT1</span><span class="p">,</span>
                <span class="n">num</span><span class="o">=</span><span class="n">N_shape</span>
            <span class="p">)</span>
            <span class="n">flux_eficiency</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">antenna_efficiency</span><span class="p">(</span><span class="n">FREQ</span><span class="p">,</span> <span class="n">SOLAR_R</span><span class="p">)</span>
            <span class="n">mask</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">V</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calibrate_QSModel</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">SOLAR_R</span><span class="p">,</span> <span class="n">FREQ</span><span class="p">,</span> <span class="n">flux_eficiency</span><span class="p">)</span>
            <span class="n">I</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">FREQ</span> <span class="o">=</span> <span class="n">I</span><span class="p">[</span><span class="o">~</span><span class="n">bad_freq</span><span class="p">],</span> <span class="n">V</span><span class="p">[</span><span class="o">~</span><span class="n">bad_freq</span><span class="p">],</span> <span class="n">FREQ</span><span class="p">[</span><span class="o">~</span><span class="n">bad_freq</span><span class="p">]</span>
            <span class="n">table</span><span class="o">.</span><span class="n">add_row</span><span class="p">([</span>
                <span class="n">OBS_DATE</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">),</span>
                <span class="n">OBS_TIME</span><span class="p">,</span>
                <span class="n">AZIMUTH</span><span class="p">,</span>
                <span class="n">SOLAR_R</span><span class="p">,</span>
                <span class="n">N_shape</span><span class="p">,</span>
                <span class="n">CRPIX</span><span class="p">,</span>
                <span class="n">CDELT1</span><span class="p">,</span>
                <span class="n">angle</span><span class="p">,</span>
                <span class="n">SOLAR_B</span><span class="p">,</span>
                <span class="n">FREQ</span><span class="p">,</span>
                <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">FREQ</span><span class="p">,</span> <span class="n">flux_eficiency</span><span class="p">)),</span>
                <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">FREQ</span><span class="p">,</span> <span class="n">I</span><span class="p">)),</span>
                <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">FREQ</span><span class="p">,</span> <span class="n">V</span><span class="p">))</span>
            <span class="p">])</span>
        <span class="k">return</span> <span class="n">table</span></div>


<div class="viewcode-block" id="RATANClient.form_data">
<a class="viewcode-back" href="../../../radiosunpy.client.html#radiosunpy.client.client.RATANClient.form_data">[docs]</a>
    <span class="k">def</span> <span class="nf">form_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_urls</span><span class="p">):</span>
        <span class="n">total_table</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">file_url</span> <span class="ow">in</span> <span class="n">file_urls</span><span class="p">:</span>
            <span class="n">hdul</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file_url</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>

            <span class="n">CDELT1</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;CDELT1&#39;</span><span class="p">]</span>
            <span class="n">CRPIX</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;CRPIX1&#39;</span><span class="p">]</span>
            <span class="n">SOLAR_R</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;SOLAR_R&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1.01175</span>
            <span class="n">SOLAR_B</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;SOLAR_B&#39;</span><span class="p">]</span>
            <span class="n">FREQ</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;FREQ&#39;</span><span class="p">]</span>
            <span class="n">OBS_DATE</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;DATE-OBS&#39;</span><span class="p">]</span>
            <span class="n">OBS_TIME</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;TIME-OBS&#39;</span><span class="p">]</span>
            <span class="n">bad_freq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">FREQ</span><span class="p">,</span> <span class="p">[</span><span class="mf">15.0938</span><span class="p">,</span> <span class="mf">15.2812</span><span class="p">,</span> <span class="mf">15.4688</span><span class="p">,</span> <span class="mf">15.6562</span><span class="p">,</span> <span class="mf">15.8438</span><span class="p">,</span> <span class="mf">16.0312</span><span class="p">,</span> <span class="mf">16.2188</span><span class="p">,</span> <span class="mf">16.4062</span><span class="p">])</span>

            <span class="n">ratan_datetime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">OBS_DATE</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">OBS_TIME</span><span class="p">,</span> <span class="s1">&#39;%Y/%m/</span><span class="si">%d</span><span class="s1"> %H:%M:%S.</span><span class="si">%f</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">noaa_datetime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">OBS_DATE</span><span class="p">,</span> <span class="s1">&#39;%Y/%m/</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">diff_hours</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">ratan_datetime</span> <span class="o">-</span> <span class="n">noaa_datetime</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">/</span> <span class="mi">3600</span><span class="p">)</span>

            <span class="n">AZIMUTH</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;AZIMUTH&#39;</span><span class="p">]</span>
            <span class="n">SOL_DEC</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;SOL_DEC&#39;</span><span class="p">]</span>
            <span class="n">SOLAR_P</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;SOLAR_P&#39;</span><span class="p">]</span>
            <span class="n">angle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pozitional_angle</span><span class="p">(</span><span class="n">AZIMUTH</span><span class="p">,</span> <span class="n">SOL_DEC</span><span class="p">,</span> <span class="n">SOLAR_P</span><span class="p">)</span>

            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
                <span class="o">-</span> <span class="n">CRPIX</span> <span class="o">*</span> <span class="n">CDELT1</span><span class="p">,</span>
                <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">CRPIX</span><span class="p">)</span> <span class="o">*</span> <span class="n">CDELT1</span><span class="p">,</span>
                <span class="n">num</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="p">)</span>

            <span class="n">flux_eficiency</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">antenna_efficiency</span><span class="p">(</span><span class="n">FREQ</span><span class="p">,</span> <span class="n">SOLAR_R</span><span class="p">)</span>
            <span class="n">mask</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">V</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calibrate_QSModel</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">SOLAR_R</span><span class="p">,</span> <span class="n">FREQ</span><span class="p">,</span> <span class="n">flux_eficiency</span><span class="p">)</span>
            <span class="n">I</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">FREQ</span> <span class="o">=</span> <span class="n">I</span><span class="p">[</span><span class="o">~</span><span class="n">bad_freq</span><span class="p">],</span> <span class="n">V</span><span class="p">[</span><span class="o">~</span><span class="n">bad_freq</span><span class="p">],</span> <span class="n">FREQ</span><span class="p">[</span><span class="o">~</span><span class="n">bad_freq</span><span class="p">]</span>

            <span class="n">srs</span> <span class="o">=</span> <span class="n">SRSClient</span><span class="p">()</span>
            <span class="n">srs_table</span> <span class="o">=</span> <span class="n">srs</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">TimeRange</span><span class="p">(</span><span class="n">OBS_DATE</span><span class="p">,</span> <span class="n">OBS_DATE</span><span class="p">))</span>
            <span class="n">srs_table</span> <span class="o">=</span> <span class="n">srs_table</span><span class="p">[</span><span class="n">srs_table</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;I&#39;</span><span class="p">]</span>
            <span class="n">srs_table</span><span class="p">[</span><span class="s1">&#39;Longitude&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">srs_table</span><span class="p">[</span><span class="s1">&#39;Longitude&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">differential_rotation</span><span class="p">(</span><span class="n">srs_table</span><span class="p">[</span><span class="s1">&#39;Latitude&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="n">diff_hours</span> <span class="o">/</span> <span class="mi">24</span>
            <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

            <span class="n">srs_table</span><span class="p">[</span><span class="s1">&#39;Latitude&#39;</span><span class="p">],</span> <span class="n">srs_table</span><span class="p">[</span><span class="s1">&#39;Longitude&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">heliocentric_transform</span><span class="p">(</span>
                <span class="n">srs_table</span><span class="p">[</span><span class="s1">&#39;Latitude&#39;</span><span class="p">],</span>
                <span class="n">srs_table</span><span class="p">[</span><span class="s1">&#39;Longitude&#39;</span><span class="p">],</span>
                <span class="n">SOLAR_R</span><span class="p">,</span>
                <span class="n">SOLAR_B</span>
            <span class="p">)</span>

            <span class="n">srs_table</span><span class="p">[</span><span class="s1">&#39;Latitude&#39;</span><span class="p">],</span> <span class="n">srs_table</span><span class="p">[</span><span class="s1">&#39;Longitude&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pozitional_rotation</span><span class="p">(</span>
                <span class="n">srs_table</span><span class="p">[</span><span class="s1">&#39;Latitude&#39;</span><span class="p">],</span>
                <span class="n">srs_table</span><span class="p">[</span><span class="s1">&#39;Longitude&#39;</span><span class="p">],</span>
                <span class="n">angle</span>
            <span class="p">)</span>

            <span class="n">ar_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_regions_search</span><span class="p">(</span><span class="n">srs_table</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span>
            <span class="n">ar_amount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ar_info</span><span class="p">)</span>
            <span class="n">ar_info</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Azimuth&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">AZIMUTH</span><span class="p">]</span> <span class="o">*</span> <span class="n">ar_amount</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;i2&#39;</span><span class="p">)),</span> <span class="n">index</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">ar_info</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span>
                <span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Amplitude&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">[[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">FREQ</span><span class="p">))]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ar_amount</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">))</span>
            <span class="n">ar_info</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span>
                <span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Mean&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">[[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">FREQ</span><span class="p">))]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ar_amount</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">))</span>
            <span class="n">ar_info</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span>
                <span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Sigma&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">[[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">FREQ</span><span class="p">))]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ar_amount</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">))</span>
            <span class="n">ar_info</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span>
                <span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;FWHM&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">[[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">FREQ</span><span class="p">))]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ar_amount</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">))</span>
            <span class="n">ar_info</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span>
                <span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Flux&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">[[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">FREQ</span><span class="p">))]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ar_amount</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">))</span>
            <span class="n">ar_info</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span>
                <span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Total Flux&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">[[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">FREQ</span><span class="p">))]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ar_amount</span><span class="p">)],</span>
                       <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">))</span>
            <span class="n">ar_info</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span>
                <span class="n">Column</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Range&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">[[{}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">FREQ</span><span class="p">))]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ar_amount</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">))</span>

            <span class="n">ratan_data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">FREQ</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">V</span><span class="p">))</span>
            <span class="n">gauss_analysis_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gauss_analysis</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ratan_data</span><span class="p">,</span> <span class="n">ar_info</span><span class="p">)</span>
            <span class="n">total_table</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gauss_analysis_info</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Table</span><span class="p">(</span><span class="n">vstack</span><span class="p">(</span><span class="n">total_table</span><span class="p">))</span></div>


<div class="viewcode-block" id="RATANClient.get_data">
<a class="viewcode-back" href="../../../radiosunpy.client.html#radiosunpy.client.client.RATANClient.get_data">[docs]</a>
    <span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timerange</span><span class="p">):</span>
        <span class="n">file_urls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">acquire_data</span><span class="p">(</span><span class="n">timerange</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">form_data</span><span class="p">(</span><span class="n">file_urls</span><span class="p">)</span></div>
</div>

</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">RadioSunPy</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules.html">RadioSunPy</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, Igor Lysov, Evgenii Kurochkin, Andrey Shendrik, Irina Knyazeva.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.1.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
    </div>

    

    
  </body>
</html>